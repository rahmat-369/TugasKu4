<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>TugasKu PRO - Manajemen Tugas Premium</title>
  <meta name="app-version" content="5.9.2">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" href="my-icon.png">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#8B5CF6">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="TugasKu PRO">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
  <style>
    /* ===== VARIABEL CSS & BASE STYLES ===== */
    :root {
      --primary: #8B5CF6;
      --primary-600: #7C3AED;
      --bg: #0f172a;
      --bg-card: #1e293b;
      --card: #1e293b;
      --muted: #94a3b8;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --glass: rgba(30, 41, 59, 0.6);
      --radius: 16px;
      --shadow: 0 10px 25px rgba(0,0,0,0.3);
      --priority-high: #ef4444;
      --priority-medium: #f59e0b;
      --priority-low: #10b981;
      --toast-bg: #1e293b;
      --toast-text: #ffffff;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    
    /* TEMA TERANG NORMAL */
    .light-mode {
      --bg: #f8fafc;
      --bg-card: #ffffff;
      --card: #ffffff;
      --muted: #6b7280;
      --glass: rgba(255,255,255,0.7);
      --toast-bg: #ffffff;
      --toast-text: #1f2937;
      color-scheme: light;
      color: #0f1724;
    }
    
    /* TEMA GELAP PROFESIONAL */
    .dark-pro-mode {
      --primary: #00c8ff;
      --primary-600: #00a8d6;
      --bg: linear-gradient(180deg, #0b0f16, #121821);
      --bg-card: #1c2430;
      --card: #1c2430;
      --muted: #a0aec0;
      --glass: rgba(28, 36, 48, 0.7);
      --toast-bg: #1c2430;
      --toast-text: #e8edf2;
      color: #e8edf2;
      --shadow: 0 10px 25px rgba(0,0,0,0.4);
    }
    
    /* TEMA GELAP PROFESIONAL SHIFT */
    .dark-pro-shift-mode {
      --primary: #8B5CF6;
      --primary-600: #7C3AED;
      --bg: linear-gradient(135deg, #0f172a, #1e1b4b);
      --bg-card: #1e293b;
      --card: #1e293b;
      --muted: #94a3b8;
      --glass: rgba(30, 41, 59, 0.6);
      --toast-bg: #1e293b;
      --toast-text: #e8edf2;
      color: #e8edf2;
      --shadow: 0 10px 25px rgba(0,0,0,0.4);
    }
    
    /* TEMA MIDNIGHT TECH (DEFAULT) */
    .midnight-tech-mode {
      --primary: #38bdf8;
      --primary-600: #0ea5e9;
      --bg: #0f172a;
      --bg-card: #1e293b;
      --card: #1e293b;
      --muted: #94a3b8;
      --glass: rgba(30, 41, 59, 0.6);
      --toast-bg: #1e293b;
      --toast-text: #f8fafc;
      color: #f8fafc;
      --shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    
    /* TEMA CARBON BLUE */
    .carbon-blue-mode {
      --primary: #3b82f6;
      --primary-600: #2563eb;
      --bg: #1e293b;
      --bg-card: #334155;
      --card: #334155;
      --muted: #cbd5e1;
      --glass: rgba(51, 65, 85, 0.6);
      --toast-bg: #334155;
      --toast-text: #f1f5f9;
      color: #f1f5f9;
      --shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    
    /* TEMA CYBER GRAY */
    .cyber-gray-mode {
      --primary: #22d3ee;
      --primary-600: #06b6d4;
      --bg: #111827;
      --bg-card: #1f2937;
      --card: #1f2937;
      --muted: #9ca3af;
      --glass: rgba(31, 41, 55, 0.6);
      --toast-bg: #1f2937;
      --toast-text: #e2e8f0;
      color: #e2e8f0;
      --shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    
    /* TEMA BLUE MIST */
    .blue-mist-mode {
      --primary: #64ffda;
      --primary-600: #48cae4;
      --bg: #0a192f;
      --bg-card: #112240;
      --card: #112240;
      --muted: #8892b0;
      --glass: rgba(17, 34, 64, 0.6);
      --toast-bg: #112240;
      --toast-text: #e0fbfc;
      color: #e0fbfc;
      --shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    
    /* TEMA PINK ELEGAN */
    .pink-elegant-mode {
      --primary: #ec4899;
      --primary-600: #db2777;
      --bg: linear-gradient(135deg, #1f1b2e, #2d1b3e);
      --bg-card: #2d1b3e;
      --card: #2d1b3e;
      --muted: #c4b5fd;
      --glass: rgba(45, 27, 62, 0.6);
      --toast-bg: #2d1b3e;
      --toast-text: #fdf2f8;
      color: #fdf2f8;
      --shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    
    /* TEMA PRO GOLD (PREMIUM BETA) */
    .pro-gold-mode {
      --primary: #FFD700;
      --primary-600: #D4AF37;
      --bg: linear-gradient(135deg, #1a1a1a, #2d2d2d);
      --bg-card: #2d2d2d;
      --card: #2d2d2d;
      --muted: #b0b0b0;
      --glass: rgba(45, 45, 45, 0.7);
      --toast-bg: #2d2d2d;
      --toast-text: #f8f8f8;
      color: #f8f8f8;
      --shadow: 0 10px 25px rgba(0,0,0,0.4);
    }
    
    /* TEMA PRO FOREST (PREMIUM) */
    .pro-forest-mode {
      --primary: #2A9D8F;
      --primary-600: #264653;
      --bg: linear-gradient(135deg, #1a2f1a, #2d4a2d);
      --bg-card: #2d4a2d;
      --card: #2d4a2d;
      --muted: #a3b18a;
      --glass: rgba(45, 74, 45, 0.6);
      --toast-bg: #2d4a2d;
      --toast-text: #dad7cd;
      color: #dad7cd;
      --shadow: 0 10px 25px rgba(0,0,0,0.3);
    }
    
    /* TEMA NEON DARK (BARU) */
    .neon-dark-mode {
      --primary: #ff00ff;
      --primary-600: #cc00cc;
      --bg: #0a0a0a;
      --bg-card: #1a1a1a;
      --card: #1a1a1a;
      --muted: #b0b0b0;
      --glass: rgba(26, 26, 26, 0.7);
      --toast-bg: #1a1a1a;
      --toast-text: #ffffff;
      color: #ffffff;
      --shadow: 0 10px 25px rgba(0,0,0,0.5);
    }
    
    /* TEMA SUNSET VIBES (BARU) */
    .sunset-vibes-mode {
      --primary: #FF6B6B;
      --primary-600: #FF5252;
      --bg: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
      --bg-card: #1a1a2e;
      --card: #1a1a2e;
      --muted: #b8b8d1;
      --glass: rgba(26, 26, 46, 0.7);
      --toast-bg: #1a1a2e;
      --toast-text: #ffffff;
      color: #ffffff;
      --shadow: 0 10px 25px rgba(0,0,0,0.4);
    }
    
    /* EFEK GLOW UNTUK PRIORITAS TINGGI */
    .priority-high-indicator {
      box-shadow: 0 0 8px 2px rgba(239, 68, 68, 0.7);
      animation: pulse-high 2s infinite;
    }
    
    @keyframes pulse-high {
      0% {
        box-shadow: 0 0 8px 2px rgba(239, 68, 68, 0.7);
      }
      50% {
        box-shadow: 0 0 12px 4px rgba(239, 68, 68, 0.9);
      }
      100% {
        box-shadow: 0 0 8px 2px rgba(239, 68, 68, 0.7);
      }
    }
    
    /* EFEK GLOW UNTUK TEMA PREMIUM */
    .pro-gold-mode .card,
    .pro-gold-mode .task-card,
    .pro-gold-mode .schedule-item,
    .pro-gold-mode .note-card,
    .pro-gold-mode .stat-card,
    .pro-gold-mode .form-section,
    .pro-gold-mode .about-section,
    .pro-gold-mode .stats-section,
    .pro-gold-mode header,
    .pro-gold-mode .calendar-day,
    .pro-gold-mode .productivity-card {
      box-shadow: 
        0 0 10px rgba(255,215,0,0.15),
        inset 0 0 5px rgba(255,215,0,0.05);
      transition: box-shadow 0.3s ease;
    }
    
    .pro-gold-mode .card:hover,
    .pro-gold-mode .task-card:hover,
    .pro-gold-mode .schedule-item:hover,
    .pro-gold-mode .note-card:hover,
    .pro-gold-mode .stat-card:hover,
    .pro-gold-mode .form-section:hover,
    .pro-gold-mode .about-section:hover,
    .pro-gold-mode .stats-section:hover,
    .pro-gold-mode header:hover,
    .pro-gold-mode .calendar-day:hover,
    .pro-gold-mode .productivity-card:hover {
      box-shadow: 
        0 0 20px rgba(255,215,0,0.3),
        inset 0 0 10px rgba(255,215,0,0.1);
    }
    
    .pro-gold-mode .fab {
      box-shadow: 
        0 18px 40px rgba(255,215,0,0.4),
        0 0 15px rgba(255,215,0,0.2);
    }
    
    .pro-gold-mode .fab:hover {
      box-shadow: 
        0 20px 45px rgba(255,215,0,0.6),
        0 0 20px rgba(255,215,0,0.3);
    }
    
    .pro-gold-mode .btn,
    .pro-gold-mode .filter-btn.active,
    .pro-gold-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(255,215,0,0.3);
    }
    
    .pro-gold-mode .btn:hover,
    .pro-gold-mode .filter-btn.active:hover,
    .pro-gold-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(255,215,0,0.4);
    }
    
    .pro-gold-mode .brand h1 {
      background: linear-gradient(135deg, #FFD700, #D4AF37);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    /* EFEK UNTUK TEMA FOREST */
    .pro-forest-mode .card,
    .pro-forest-mode .task-card,
    .pro-forest-mode .schedule-item,
    .pro-forest-mode .note-card,
    .pro-forest-mode .stat-card,
    .pro-forest-mode .form-section,
    .pro-forest-mode .about-section,
    .pro-forest-mode .stats-section,
    .pro-forest-mode header,
    .pro-forest-mode .calendar-day,
    .pro-forest-mode .productivity-card {
      box-shadow: 
        0 0 10px rgba(42,157,143,0.15),
        inset 0 0 5px rgba(42,157,143,0.05);
      transition: box-shadow 0.3s ease;
    }
    
    .pro-forest-mode .card:hover,
    .pro-forest-mode .task-card:hover,
    .pro-forest-mode .schedule-item:hover,
    .pro-forest-mode .note-card:hover,
    .pro-forest-mode .stat-card:hover,
    .pro-forest-mode .form-section:hover,
    .pro-forest-mode .about-section:hover,
    .pro-forest-mode .stats-section:hover,
    .pro-forest-mode header:hover,
    .pro-forest-mode .calendar-day:hover,
    .pro-forest-mode .productivity-card:hover {
      box-shadow: 
        0 0 20px rgba(42,157,143,0.3),
        inset 0 0 10px rgba(42,157,143,0.1);
    }
    
    .pro-forest-mode .fab {
      box-shadow: 
        0 18px 40px rgba(42,157,143,0.4),
        0 0 15px rgba(42,157,143,0.2);
    }
    
    .pro-forest-mode .fab:hover {
      box-shadow: 
        0 20px 45px rgba(42,157,143,0.6),
        0 0 20px rgba(42,157,143,0.3);
    }
    
    .pro-forest-mode .btn,
    .pro-forest-mode .filter-btn.active,
    .pro-forest-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(42,157,143,0.3);
    }
    
    .pro-forest-mode .btn:hover,
    .pro-forest-mode .filter-btn.active:hover,
    .pro-forest-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(42,157,143,0.4);
    }
    
    .pro-forest-mode .brand h1 {
      background: linear-gradient(135deg, #2A9D8F, #264653);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    /* EFEK UNTUK TEMA NEON DARK */
    .neon-dark-mode .card,
    .neon-dark-mode .task-card,
    .neon-dark-mode .schedule-item,
    .neon-dark-mode .note-card,
    .neon-dark-mode .stat-card,
    .neon-dark-mode .form-section,
    .neon-dark-mode .about-section,
    .neon-dark-mode .stats-section,
    .neon-dark-mode header,
    .neon-dark-mode .calendar-day,
    .neon-dark-mode .productivity-card {
      box-shadow: 
        0 0 10px rgba(255,0,255,0.15),
        inset 0 0 5px rgba(255,0,255,0.05);
      transition: box-shadow 0.3s ease;
    }
    
    .neon-dark-mode .card:hover,
    .neon-dark-mode .task-card:hover,
    .neon-dark-mode .schedule-item:hover,
    .neon-dark-mode .note-card:hover,
    .neon-dark-mode .stat-card:hover,
    .neon-dark-mode .form-section:hover,
    .neon-dark-mode .about-section:hover,
    .neon-dark-mode .stats-section:hover,
    .neon-dark-mode header:hover,
    .neon-dark-mode .calendar-day:hover,
    .neon-dark-mode .productivity-card:hover {
      box-shadow: 
        0 0 20px rgba(255,0,255,0.3),
        inset 0 0 10px rgba(255,0,255,0.1);
    }
    
    .neon-dark-mode .fab {
      box-shadow: 
        0 18px 40px rgba(255,0,255,0.4),
        0 0 15px rgba(255,0,255,0.2);
    }
    
    .neon-dark-mode .fab:hover {
      box-shadow: 
        0 20px 45px rgba(255,0,255,0.6),
        0 0 20px rgba(255,0,255,0.3);
    }
    
    .neon-dark-mode .btn,
    .neon-dark-mode .filter-btn.active,
    .neon-dark-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(255,0,255,0.3);
    }
    
    .neon-dark-mode .btn:hover,
    .neon-dark-mode .filter-btn.active:hover,
    .neon-dark-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(255,0,255,0.4);
    }
    
    .neon-dark-mode .brand h1 {
      background: linear-gradient(135deg, #ff00ff, #cc00cc);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    /* EFEK UNTUK TEMA SUNSET VIBES */
    .sunset-vibes-mode .card,
    .sunset-vibes-mode .task-card,
    .sunset-vibes-mode .schedule-item,
    .sunset-vibes-mode .note-card,
    .sunset-vibes-mode .stat-card,
    .sunset-vibes-mode .form-section,
    .sunset-vibes-mode .about-section,
    .sunset-vibes-mode .stats-section,
    .sunset-vibes-mode header,
    .sunset-vibes-mode .calendar-day,
    .sunset-vibes-mode .productivity-card {
      box-shadow: 
        0 0 10px rgba(255,107,107,0.15),
        inset 0 0 5px rgba(255,107,107,0.05);
      transition: box-shadow 0.3s ease;
    }
    
    .sunset-vibes-mode .card:hover,
    .sunset-vibes-mode .task-card:hover,
    .sunset-vibes-mode .schedule-item:hover,
    .sunset-vibes-mode .note-card:hover,
    .sunset-vibes-mode .stat-card:hover,
    .sunset-vibes-mode .form-section:hover,
    .sunset-vibes-mode .about-section:hover,
    .sunset-vibes-mode .stats-section:hover,
    .sunset-vibes-mode header:hover,
    .sunset-vibes-mode .calendar-day:hover,
    .sunset-vibes-mode .productivity-card:hover {
      box-shadow: 
        0 0 20px rgba(255,107,107,0.3),
        inset 0 0 10px rgba(255,107,107,0.1);
    }
    
    .sunset-vibes-mode .fab {
      box-shadow: 
        0 18px 40px rgba(255,107,107,0.4),
        0 0 15px rgba(255,107,107,0.2);
    }
    
    .sunset-vibes-mode .fab:hover {
      box-shadow: 
        0 20px 45px rgba(255,107,107,0.6),
        0 0 20px rgba(255,107,107,0.3);
    }
    
    .sunset-vibes-mode .btn,
    .sunset-vibes-mode .filter-btn.active,
    .sunset-vibes-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(255,107,107,0.3);
    }
    
    .sunset-vibes-mode .btn:hover,
    .sunset-vibes-mode .filter-btn.active:hover,
    .sunset-vibes-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(255,107,107,0.4);
    }
    
    .sunset-vibes-mode .brand h1 {
      background: linear-gradient(135deg, #FF6B6B, #FF5252);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    /* EFEK GLOW UNTUK TEMA GELAP PROFESIONAL */
    .dark-pro-mode .card,
    .dark-pro-mode .task-card,
    .dark-pro-mode .schedule-item,
    .dark-pro-mode .note-card,
    .dark-pro-mode .stat-card,
    .dark-pro-mode .form-section,
    .dark-pro-mode .about-section,
    .dark-pro-mode .stats-section,
    .dark-pro-mode header,
    .dark-pro-mode .calendar-day,
    .dark-pro-mode .productivity-card {
      box-shadow: 
        0 0 10px rgba(0,200,255,0.15),
        inset 0 0 5px rgba(0,200,255,0.05);
      transition: box-shadow 0.3s ease;
    }
    
    .dark-pro-mode .card:hover,
    .dark-pro-mode .task-card:hover,
    .dark-pro-mode .schedule-item:hover,
    .dark-pro-mode .note-card:hover,
    .dark-pro-mode .stat-card:hover,
    .dark-pro-mode .form-section:hover,
    .dark-pro-mode .about-section:hover,
    .dark-pro-mode .stats-section:hover,
    .dark-pro-mode header:hover,
    .dark-pro-mode .calendar-day:hover,
    .dark-pro-mode .productivity-card:hover {
      box-shadow: 
        0 0 20px rgba(0,200,255,0.3),
        inset 0 0 10px rgba(0,200,255,0.1);
    }
    
    .dark-pro-mode .fab {
      box-shadow: 
        0 18px 40px rgba(0,200,255,0.4),
        0 0 15px rgba(0,200,255,0.2);
    }
    
    .dark-pro-mode .fab:hover {
      box-shadow: 
        0 20px 45px rgba(0,200,255,0.6),
        0 0 20px rgba(0,200,255,0.3);
    }
    
    .dark-pro-mode .btn,
    .dark-pro-mode .filter-btn.active,
    .dark-pro-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(0,200,255,0.3);
    }
    
    .dark-pro-mode .btn:hover,
    .dark-pro-mode .filter-btn.active:hover,
    .dark-pro-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(0,200,255,0.4);
    }
    
    /* EFEK GLOW UNTUK TEMA GELAP PROFESIONAL SHIFT */
    .dark-pro-shift-mode .card,
    .dark-pro-shift-mode .task-card,
    .dark-pro-shift-mode .schedule-item,
    .dark-pro-shift-mode .note-card,
    .dark-pro-shift-mode .stat-card,
    .dark-pro-shift-mode .form-section,
    .dark-pro-shift-mode .about-section,
    .dark-pro-shift-mode .stats-section,
    .dark-pro-shift-mode header,
    .dark-pro-shift-mode .calendar-day,
    .dark-pro-shift-mode .productivity-card {
      box-shadow: 
        0 0 10px rgba(139,92,246,0.15),
        inset 0 0 5px rgba(139,92,246,0.05);
      transition: box-shadow 0.3s ease;
    }
    
    .dark-pro-shift-mode .card:hover,
    .dark-pro-shift-mode .task-card:hover,
    .dark-pro-shift-mode .schedule-item:hover,
    .dark-pro-shift-mode .note-card:hover,
    .dark-pro-shift-mode .stat-card:hover,
    .dark-pro-shift-mode .form-section:hover,
    .dark-pro-shift-mode .about-section:hover,
    .dark-pro-shift-mode .stats-section:hover,
    .dark-pro-shift-mode header:hover,
    .dark-pro-shift-mode .calendar-day:hover,
    .dark-pro-shift-mode .productivity-card:hover {
      box-shadow: 
        0 0 20px rgba(139,92,246,0.3),
        inset 0 0 10px rgba(139,92,246,0.1);
    }
    
    .dark-pro-shift-mode .fab {
      box-shadow: 
        0 18px 40px rgba(139,92,246,0.4),
        0 0 15px rgba(139,92,246,0.2);
    }
    
    .dark-pro-shift-mode .fab:hover {
      box-shadow: 
        0 20px 45px rgba(139,92,246,0.6),
        0 0 20px rgba(139,92,246,0.3);
    }
    
    .dark-pro-shift-mode .btn,
    .dark-pro-shift-mode .filter-btn.active,
    .dark-pro-shift-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(139,92,246,0.3);
    }
    
    .dark-pro-shift-mode .btn:hover,
    .dark-pro-shift-mode .filter-btn.active:hover,
    .dark-pro-shift-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(139,92,246,0.4);
    }
    
    /* EFEK UNTUK TEMA MIDNIGHT TECH */
    .midnight-tech-mode .fab,
    .midnight-tech-mode .btn,
    .midnight-tech-mode .filter-btn.active,
    .midnight-tech-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(56,189,248,0.3);
    }
    
    .midnight-tech-mode .fab:hover,
    .midnight-tech-mode .btn:hover,
    .midnight-tech-mode .filter-btn.active:hover,
    .midnight-tech-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(56,189,248,0.4);
    }
    
    /* EFEK UNTUK TEMA CARBON BLUE */
    .carbon-blue-mode .fab,
    .carbon-blue-mode .btn,
    .carbon-blue-mode .filter-btn.active,
    .carbon-blue-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(59,130,246,0.3);
    }
    
    .carbon-blue-mode .fab:hover,
    .carbon-blue-mode .btn:hover,
    .carbon-blue-mode .filter-btn.active:hover,
    .carbon-blue-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(59,130,246,0.4);
    }
    
    /* EFEK UNTUK TEMA CYBER GRAY */
    .cyber-gray-mode .fab,
    .cyber-gray-mode .btn,
    .cyber-gray-mode .filter-btn.active,
    .cyber-gray-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(34,211,238,0.3);
    }
    
    .cyber-gray-mode .fab:hover,
    .cyber-gray-mode .btn:hover,
    .cyber-gray-mode .filter-btn.active:hover,
    .cyber-gray-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(34,211,238,0.4);
    }
    
    /* EFEK UNTUK TEMA BLUE MIST */
    .blue-mist-mode .fab,
    .blue-mist-mode .btn,
    .blue-mist-mode .filter-btn.active,
    .blue-mist-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(100,255,218,0.3);
    }
    
    .blue-mist-mode .fab:hover,
    .blue-mist-mode .btn:hover,
    .blue-mist-mode .filter-btn.active:hover,
    .blue-mist-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(100,255,218,0.4);
    }
    
    /* EFEK UNTUK TEMA PINK ELEGAN */
    .pink-elegant-mode .card,
    .pink-elegant-mode .task-card,
    .pink-elegant-mode .schedule-item,
    .pink-elegant-mode .note-card,
    .pink-elegant-mode .stat-card,
    .pink-elegant-mode .form-section,
    .pink-elegant-mode .about-section,
    .pink-elegant-mode .stats-section,
    .pink-elegant-mode header,
    .pink-elegant-mode .calendar-day,
    .pink-elegant-mode .productivity-card {
      box-shadow: 
        0 0 10px rgba(236,72,153,0.15),
        inset 0 0 5px rgba(236,72,153,0.05);
      transition: box-shadow 0.3s ease;
    }
    
    .pink-elegant-mode .card:hover,
    .pink-elegant-mode .task-card:hover,
    .pink-elegant-mode .schedule-item:hover,
    .pink-elegant-mode .note-card:hover,
    .pink-elegant-mode .stat-card:hover,
    .pink-elegant-mode .form-section:hover,
    .pink-elegant-mode .about-section:hover,
    .pink-elegant-mode .stats-section:hover,
    .pink-elegant-mode header:hover,
    .pink-elegant-mode .calendar-day:hover,
    .pink-elegant-mode .productivity-card:hover {
      box-shadow: 
        0 0 20px rgba(236,72,153,0.3),
        inset 0 0 10px rgba(236,72,153,0.1);
    }
    
    .pink-elegant-mode .fab {
      box-shadow: 
        0 18px 40px rgba(236,72,153,0.4),
        0 0 15px rgba(236,72,153,0.2);
    }
    
    .pink-elegant-mode .fab:hover {
      box-shadow: 
        0 20px 45px rgba(236,72,153,0.6),
        0 0 20px rgba(236,72,153,0.3);
    }
    
    .pink-elegant-mode .btn,
    .pink-elegant-mode .filter-btn.active,
    .pink-elegant-mode .filter-btn:hover {
      box-shadow: 0 4px 12px rgba(236,72,153,0.3);
    }
    
    .pink-elegant-mode .btn:hover,
    .pink-elegant-mode .filter-btn.active:hover,
    .pink-elegant-mode .filter-btn:hover {
      box-shadow: 0 6px 15px rgba(236,72,153,0.4);
    }
    
    /* LOGO BARU DENGAN EFEK NEON */
    .logo-neon {
      background: linear-gradient(135deg, #00c8ff, #8B5CF6);
      box-shadow: 0 0 10px rgba(0,200,255,0.5);
      animation: neon-pulse 3s infinite;
    }
    
    @keyframes neon-pulse {
      0%, 100% {
        box-shadow: 0 0 10px rgba(0,200,255,0.5);
      }
      50% {
        box-shadow: 0 0 20px rgba(0,200,255,0.8), 0 0 30px rgba(0,200,255,0.6);
      }
    }
    
    /* TRANSISI HALUS UNTUK SEMUA ELEMEN */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      transition: background-color 0.4s, color 0.4s, box-shadow 0.4s, border-color 0.4s;
    }
    
    html, body {
      height: 100%;
      overflow-x: hidden;
    }
    
    body {
      background: var(--bg);
      min-height: 100vh;
      color: #e6eef8;
      padding: 0;
      -webkit-font-smoothing: antialiased;
      display: flex;
      flex-direction: column;
    }
    
    .light-mode input,
    .light-mode textarea,
    .light-mode select {
      color: #0f1724;
      border-color: rgba(0,0,0,0.1);
      background: rgba(0,0,0,0.02);
    }
    
    /* CONTAINER */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 12px;
      width: 100%;
      flex: 1;
      padding-bottom: 80px;
    }
    
    /* HEADER STYLES DENGAN OPTIMASI BLUR */
    header {
      position: sticky;
      top: 12px;
      z-index: 40;
      margin-bottom: 18px;
      background: linear-gradient(180deg, rgba(30,41,59,0.85), rgba(30,41,59,0.70));
      backdrop-filter: blur(12px) saturate(180%);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      border: 1px solid rgba(255,255,255,0.08);
      flex-wrap: wrap;
      animation: slideDown 0.5s ease-out;
      transition: backdrop-filter 0.3s ease;
    }
    
    .header-scrolling {
      backdrop-filter: none;
    }
    
    .light-mode header {
      background: linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.70));
      border: 1px solid rgba(0,0,0,0.08);
    }
    
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo {
      width: 40px;
      height: 40px;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 10px;
      background: var(--primary);
      color: #fff;
      flex-shrink: 0;
      animation: pulse 2s infinite;
    }
    
    .logo .app-icon {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      border-radius: 8px;
    }
    
    .brand h1 {
      font-size: 20px;
      font-weight: 700;
      background: linear-gradient(135deg, #8B5CF6, #EC4899);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .light-mode .brand h1 {
      background: linear-gradient(135deg, #3B82F6, #2563EB);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .dark-pro-mode .brand h1 {
      background: linear-gradient(135deg, #00c8ff, #0095ff);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .dark-pro-shift-mode .brand h1 {
      background: linear-gradient(135deg, #8B5CF6, #7C3AED);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .midnight-tech-mode .brand h1 {
      background: linear-gradient(135deg, #38bdf8, #0ea5e9);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .carbon-blue-mode .brand h1 {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .cyber-gray-mode .brand h1 {
      background: linear-gradient(135deg, #22d3ee, #06b6d4);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .blue-mist-mode .brand h1 {
      background: linear-gradient(135deg, #64ffda, #48cae4);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .pink-elegant-mode .brand h1 {
      background: linear-gradient(135deg, #ec4899, #db2777);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .pro-gold-mode .brand h1 {
      background: linear-gradient(135deg, #FFD700, #D4AF37);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .pro-forest-mode .brand h1 {
      background: linear-gradient(135deg, #2A9D8F, #264653);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .neon-dark-mode .brand h1 {
      background: linear-gradient(135deg, #ff00ff, #cc00cc);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .sunset-vibes-mode .brand h1 {
      background: linear-gradient(135deg, #FF6B6B, #FF5252);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .header-actions {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .icon-btn {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.08);
      background: var(--bg-card);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      animation: fadeIn 0.5s ease-out;
    }
    
    .light-mode .icon-btn {
      border-color: rgba(0,0,0,0.08);
      background: var(--card);
    }
    
    .icon-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .icon-btn:active {
      transform: scale(0.95);
    }
    
    /* MENU DRAWER */
    .menu-drawer {
      position: fixed;
      top: 0;
      right: -100%;
      width: 85%;
      max-width: 320px;
      height: 100%;
      background: var(--bg-card);
      z-index: 1000;
      transition: right 0.3s ease;
      box-shadow: -5px 0 25px rgba(0,0,0,0.3);
      display: flex;
      flex-direction: column;
      padding: 20px;
      overflow-y: auto;
      backdrop-filter: blur(10px);
    }
    
    .menu-drawer.open {
      right: 0;
      animation: slideInRight 0.3s ease-out;
    }
    
    @keyframes slideInRight {
      from {
        right: -100%;
        opacity: 0;
      }
      to {
        right: 0;
        opacity: 1;
      }
    }
    
    .menu-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .light-mode .menu-header {
      border-bottom-color: rgba(0,0,0,0.1);
    }
    
    .menu-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--muted);
      padding: 8px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
    }
    
    .menu-close:hover {
      background: rgba(255,255,255,0.05);
    }
    
    .light-mode .menu-close:hover {
      background: rgba(0,0,0,0.05);
    }
    
    .menu-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s;
      margin-bottom: 8px;
      font-weight: 500;
      animation: fadeIn 0.5s ease-out;
      animation-fill-mode: both;
    }
    
    .menu-item:nth-child(1) { animation-delay: 0.1s; }
    .menu-item:nth-child(2) { animation-delay: 0.15s; }
    .menu-item:nth-child(3) { animation-delay: 0.2s; }
    .menu-item:nth-child(4) { animation-delay: 0.25s; }
    .menu-item:nth-child(5) { animation-delay: 0.3s; }
    .menu-item:nth-child(6) { animation-delay: 0.35s; }
    .menu-item:nth-child(7) { animation-delay: 0.4s; }
    .menu-item:nth-child(8) { animation-delay: 0.45s; }
    .menu-item:nth-child(9) { animation-delay: 0.5s; }
    
    .menu-item:hover {
      background: rgba(255,255,255,0.05);
    }
    
    .light-mode .menu-item:hover {
      background: rgba(0,0,0,0.05);
    }
    
    /* MENU ITEM UNTUK WEB UTAMA (LEBIH MENCOLOK) */
    .menu-item-highlight {
      background: linear-gradient(135deg, var(--primary), var(--primary-600));
      color: white;
      font-weight: 600;
      box-shadow: 0 0 20px rgba(var(--primary-rgb), 0.4);
    }
    
    .menu-item-highlight:hover {
      background: linear-gradient(135deg, var(--primary-600), var(--primary));
      box-shadow: 0 0 25px rgba(var(--primary-rgb), 0.6);
    }
    
    .menu-divider {
      height: 1px;
      background: rgba(255,255,255,0.1);
      margin: 16px 0;
    }
    
    .light-mode .menu-divider {
      background: rgba(0,0,0,0.1);
    }
    
    /* PROFILE SECTION IN MENU */
    .profile-section {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      border-radius: 12px;
      background: rgba(255,255,255,0.05);
      margin-bottom: 20px;
      cursor: pointer;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .light-mode .profile-section {
      background: rgba(0,0,0,0.05);
      border-bottom-color: rgba(0,0,0,0.1);
    }
    
    .profile-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: white;
      overflow: hidden;
      position: relative;
      flex-shrink: 0;
    }
    
    .profile-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 50%;
    }
    
    .profile-info {
      flex: 1;
      min-width: 0;
    }
    
    .profile-name {
      font-weight: 600;
      margin-bottom: 4px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .profile-desc {
      font-size: 12px;
      color: var(--muted);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    /* TAB NAVIGATION */
    .tab-navigation {
      display: flex;
      background: rgba(255,255,255,0.05);
      padding: 4px;
      border-radius: 12px;
      margin-bottom: 20px;
      animation: fadeIn 0.6s ease-out;
      overflow-x: auto;
    }
    
    .light-mode .tab-navigation {
      background: rgba(0,0,0,0.05);
    }
    
    .tab-btn {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s ease;
      color: var(--muted);
      min-width: 100px;
      white-space: nowrap;
    }
    
    .tab-btn.active {
      background: var(--card);
      box-shadow: var(--shadow);
      color: white;
    }
    
    .light-mode .tab-btn.active {
      color: #0f1724;
    }
    
    .tab-content {
      display: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    
    .tab-content.active {
      display: block;
      opacity: 1;
      animation: fadeUp 0.5s ease-out;
    }
    
    /* FORM & FIELD STYLES */
    .form-section {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      animation: fadeUp 0.5s ease-out;
      backdrop-filter: blur(10px);
    }
    
    .controls {
      display: flex;
      gap: 10px;
    }
    
    .field {
      margin-bottom: 16px;
      position: relative;
    }
    
    .field label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      font-size: 14px;
    }
    
    .field input,
    .field textarea,
    .field select {
      width: 100%;
      padding: 12px 14px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.1);
      background: var(--glass);
      font-family: inherit;
      font-size: 15px;
      outline: 0;
      transition: border-color 0.2s, box-shadow 0.2s;
      color: inherit;
    }
    
    .light-mode .field input,
    .light-mode .field textarea,
    .light-mode .field select {
      border-color: rgba(0,0,0,0.1);
    }
    
    .field input:focus,
    .field textarea:focus,
    .field select:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.2);
    }
    
    /* FILTER SECTION */
    .filter-section {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 20px;
      animation: fadeIn 0.6s ease-out;
    }
    
    .filter-btn {
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,0.1);
      background: transparent;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--muted);
    }
    
    .light-mode .filter-btn {
      border-color: rgba(0,0,0,0.1);
    }
    
    .filter-btn.active,
    .filter-btn:hover {
      background: var(--primary);
      color: #fff;
      border-color: var(--primary);
      transform: translateY(-2px);
    }
    
    /* TASK CARD */
    .task-card {
      background: var(--card);
      padding: 18px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 16px;
      position: relative;
      border-left: 4px solid transparent;
      transition: all 0.2s ease;
      overflow: hidden;
      animation: fadeUp 0.5s ease-out;
      backdrop-filter: blur(5px);
      cursor: move;
    }
    
    .task-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 28px rgba(0,0,0,0.25);
    }
    
    .task-card.dragging {
      opacity: 0.5;
      transform: rotate(5deg);
    }
    
    .task-title {
      font-weight: 700;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 8px;
    }
    
    /* PRIORITY INDICATOR */
    .priority-indicator {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      display: inline-block;
      flex-shrink: 0;
      margin-right: 8px;
      line-height: 14px;
      text-align: center;
      font-size: 12px;
    }
    
    .priority-high-indicator { 
      background: var(--priority-high); 
    }
    .priority-medium-indicator { background: var(--priority-medium); }
    .priority-low-indicator { background: var(--priority-low); }
    
    .task-title .title-text {
      display: inline-block;
      overflow-wrap: anywhere;
      word-break: break-word;
      white-space: normal;
      flex: 1;
    }
    
    .task-detail {
      font-size: 14px;
      color: var(--muted);
      display: flex;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 8px;
      word-break: break-word;
    }
    
    .task-detail .long-text {
      max-height: 120px;
      overflow-y: auto;
      padding-right: 6px;
    }
    
    .task-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      margin-top: 16px;
      padding-top: 12px;
      border-top: 1px solid rgba(255,255,255,0.05);
    }
    
    .light-mode .task-actions {
      border-top-color: rgba(0,0,0,0.05);
    }
    
    .status-pill {
      position: absolute;
      top: 12px;
      right: 12px;
      padding: 4px 10px;
      border-radius: 999px;
      font-weight: 700;
      font-size: 12px;
      z-index: 30;
      pointer-events: none;
      white-space: nowrap;
    }
    
    /* PRIORITY AND DEADLINE CLASSES */
    .priority-high { border-left-color: var(--priority-high); }
    .priority-medium { border-left-color: var(--priority-medium); }
    .priority-low { border-left-color: var(--priority-low); }
    .dl-ok { border-left-color: var(--success); }
    .dl-soon { border-left-color: var(--warning); }
    .dl-urgent { border-left-color: var(--danger); }
    .dl-overdue { border-left-color: #6b7280; opacity: 0.85; }
    
    /* PRIORITY BADGE KEPT FOR COMPATIBILITY */
    .priority-badge {
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 11px;
      font-weight: 700;
      margin-left: auto;
    }
    
    .priority-high-badge { background-color: var(--priority-high); color: white; }
    .priority-medium-badge { background-color: var(--priority-medium); color: white; }
    .priority-low-badge { background-color: var(--priority-low); color: white; }
    
    /* FAB */
    .fab {
      position: fixed;
      right: 20px;
      bottom: calc(20px + env(safe-area-inset-bottom));
      width: 60px;
      height: 60px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--primary), var(--primary-600));
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 24px;
      box-shadow: 0 18px 40px rgba(var(--primary-rgb), 0.3);
      cursor: pointer;
      border: 0;
      z-index: 60;
      transition: all 0.2s ease;
      animation: pulse 2s infinite;
    }
    
    .fab:hover {
      transform: scale(1.05);
      box-shadow: 0 20px 45px rgba(var(--primary-rgb), 0.4);
    }
    
    .fab:active {
      transform: scale(0.95);
    }
    
    /* TOAST */
    .toast {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 100px;
      background: var(--toast-bg);
      color: var(--toast-text);
      padding: 12px 18px;
      border-radius: 10px;
      opacity: 0;
      pointer-events: none;
      transition: opacity .2s;
      z-index: 80;
      font-size: 14px;
      text-align: center;
      max-width: 80%;
      box-shadow: var(--shadow);
    }
    
    .toast.show {
      opacity: 1;
      pointer-events: auto;
      animation: slideUp 0.3s ease-out;
    }
    
    /* WATERMARK */
    .watermark {
      position: fixed;
      left: 12px;
      bottom: 12px;
      font-size: 12px;
      color: var(--muted);
      opacity: 0.28;
      pointer-events: none;
      z-index: 70;
      background: transparent;
      padding: 4px 6px;
      border-radius: 8px;
    }
    
    .light-mode .watermark {
      opacity: 0.18;
    }
    
    /* EMPTY STATE */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--muted);
      animation: fadeIn 0.6s ease-out;
    }
    
    .empty-state h3 {
      margin-bottom: 8px;
    }
    
    /* BUTTON STYLES */
    .btn {
      background: linear-gradient(135deg, var(--primary), var(--primary-600));
      color: #fff;
      padding: 12px 18px;
      border-radius: 10px;
      border: 0;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      box-shadow: 0 4px 12px rgba(var(--primary-rgb), 0.3);
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(var(--primary-rgb), 0.4);
    }
    
    .btn:active {
      transform: scale(0.98);
    }
    
    /* SCHEDULE STYLES */
    .schedule-day {
      margin-bottom: 20px;
      animation: fadeUp 0.5s ease-out;
    }
    
    .schedule-header {
      font-weight: 700;
      font-size: 18px;
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }
    
    .light-mode .schedule-header {
      border-bottom-color: rgba(0,0,0,0.06);
    }
    
    .schedule-item {
      background: var(--card);
      padding: 14px;
      border-radius: 10px;
      margin-bottom: 10px;
      box-shadow: var(--shadow);
      display: flex;
      justify-content: space-between;
      align-items: center;
      transition: all 0.2s ease;
    }
    
    .schedule-item:hover {
      transform: translateY(-2px);
    }
    
    .schedule-time {
      font-weight: 600;
      color: var(--primary);
      min-width: 80px;
    }
    
    .schedule-subject {
      font-weight: 600;
      flex: 1;
      margin: 0 12px;
    }
    
    .schedule-desc {
      font-size: 14px;
      color: var(--muted);
      flex: 2;
      margin-right: 12px;
    }
    
    .schedule-actions {
      display: flex;
      gap: 8px;
    }
    
    /* ABOUT PAGE STYLES */
    .about-section {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
    }
    
    .about-logo {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .about-logo .logo {
      width: 80px;
      height: 80px;
      font-size: 36px;
      margin: 0 auto 16px;
      padding: 6px;
    }
    
    .about-logo .logo .app-icon {
      border-radius: 12px;
    }
    
    .feature-list {
      margin: 16px 0;
      padding-left: 20px;
    }
    
    .feature-list li {
      margin-bottom: 8px;
    }
    
    .version-info {
      text-align: center;
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid rgba(255,255,255,0.06);
    }
    
    .light-mode .version-info {
      border-top-color: rgba(0,0,0,0.06);
    }
    
    /* MODAL STYLES */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      backdrop-filter: blur(5px);
    }
    
    .modal-overlay.show {
      opacity: 1;
      pointer-events: auto;
    }
    
    .modal {
      background: var(--card);
      border-radius: var(--radius);
      padding: 24px;
      max-width: 90%;
      width: 400px;
      max-height: 80%;
      overflow-y: auto;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
      animation: modalSlideIn 0.3s ease-out;
      backdrop-filter: blur(10px);
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--muted);
      transition: transform 0.2s;
      padding: 8px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
    }
    
    .modal-close:hover {
      transform: scale(1.1);
      background: rgba(255,255,255,0.05);
    }
    
    /* BADGE FOR TASK COUNT */
    .badge {
      position: absolute;
      top: -8px;
      right: -8px;
      min-width: 20px;
      height: 20px;
      border-radius: 999px;
      background: var(--danger);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 12px;
      box-shadow: 0 2px 6px rgba(239,68,68,0.3);
      z-index: 10;
    }
    
    /* THEME SELECTION MODAL */
    .theme-option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.2s;
      margin-bottom: 8px;
    }
    
    .theme-option:hover {
      background: rgba(255,255,255,0.05);
      transform: translateX(5px);
    }
    
    .light-mode .theme-option:hover {
      background: rgba(0,0,0,0.05);
    }
    
    .theme-preview {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }
    
    /* NOTES STYLES */
    .note-card {
      background: var(--card);
      padding: 18px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 16px;
      position: relative;
      transition: all 0.2s ease;
      animation: fadeUp 0.5s ease-out;
    }
    
    .note-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 28px rgba(0,0,0,0.25);
    }
    
    .note-title {
      font-weight: 700;
      font-size: 18px;
      margin-bottom: 8px;
      word-break: break-word;
    }
    
    .note-content {
      font-size: 14px;
      margin-bottom: 12px;
      word-break: break-word;
      white-space: pre-wrap;
      color: var(--muted);
      max-height: 160px;
      overflow-y: auto;
    }
    
    .note-meta {
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 12px;
    }
    
    .note-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
    }
    
    /* STATS MODAL STYLES */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 16px;
      margin-top: 16px;
    }
    
    .stat-card {
      background: var(--bg-card);
      border-radius: 12px;
      padding: 16px;
      text-align: center;
      box-shadow: var(--shadow);
      transition: all 0.2s ease;
      backdrop-filter: blur(5px);
      position: relative;
      overflow: hidden;
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--primary);
    }
    
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 25px rgba(0,0,0,0.2);
    }
    
    .stat-value {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 4px;
      background: linear-gradient(135deg, var(--primary), var(--primary-600));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .stat-label {
      font-size: 14px;
      color: var(--muted);
    }
    
    /* CHART CONTAINER */
    .chart-wrap {
      margin-top: 20px;
      background: transparent;
      border-radius: var(--radius);
      padding: 16px;
      background: var(--bg-card);
    }
    
    .chart-container {
      width: 100%;
      height: 220px;
      position: relative;
    }
    
    /* STATS SECTION ON HOME */
    .stats-section {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      animation: fadeUp 0.5s ease-out;
      backdrop-filter: blur(5px);
    }
    
    .stats-section h3 {
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    /* PROFILE MODAL STYLES */
    .profile-modal .avatar-options {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin: 16px 0;
    }
    
    .avatar-option {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      cursor: pointer;
      transition: all 0.2s;
      border: 2px solid transparent;
    }
    
    .avatar-option:hover {
      transform: scale(1.1);
    }
    
    .avatar-option.selected {
      border-color: var(--primary);
      box-shadow: 0 0 10px var(--primary);
    }
    
    .profile-modal .upload-btn {
      display: block;
      width: 100%;
      padding: 12px;
      margin: 16px 0;
      border-radius: 10px;
      background: rgba(255,255,255,0.05);
      border: 1px dashed rgba(255,255,255,0.2);
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .light-mode .profile-modal .upload-btn {
      background: rgba(0,0,0,0.05);
      border-color: rgba(0,0,0,0.2);
    }
    
    .profile-modal .upload-btn:hover {
      background: rgba(255,255,255,0.1);
    }
    
    .light-mode .profile-modal .upload-btn:hover {
      background: rgba(0,0,0,0.1);
    }
    
    .profile-modal .actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
    }
    
    .profile-modal .actions .btn {
      flex: 1;
    }
    
    /* CROP MODAL STYLES */
    .crop-modal .crop-container {
      width: 100%;
      height: 300px;
      margin: 16px 0;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .crop-modal .crop-area {
      position: absolute;
      border: 2px solid var(--primary);
      box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5);
      cursor: move;
      z-index: 10;
    }
    
    .crop-modal .crop-handle {
      position: absolute;
      width: 12px;
      height: 12px;
      background: var(--primary);
      border-radius: 50%;
      z-index: 11;
    }
    
    .crop-modal .crop-handle.nw { top: -6px; left: -6px; cursor: nw-resize; }
    .crop-modal .crop-handle.ne { top: -6px; right: -6px; cursor: ne-resize; }
    .crop-modal .crop-handle.sw { bottom: -6px; left: -6px; cursor: sw-resize; }
    .crop-modal .crop-handle.se { bottom: -6px; right: -6px; cursor: se-resize; }
    
    .crop-modal .crop-preview {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      margin: 16px auto;
      overflow: hidden;
      border: 2px solid var(--primary);
      box-shadow: 0 4px 12px rgba(var(--primary-rgb), 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .crop-modal .crop-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .crop-modal .crop-controls {
      display: flex;
      gap: 10px;
      margin-top: 16px;
    }
    
    .crop-modal .crop-controls .btn {
      flex: 1;
    }
    
    .crop-modal .crop-size-controls {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-top: 12px;
    }
    
    .crop-modal .size-slider {
      flex: 1;
      -webkit-appearance: none;
      height: 6px;
      border-radius: 3px;
      background: rgba(255,255,255,0.1);
      outline: none;
    }
    
    .crop-modal .size-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: var(--primary);
      cursor: pointer;
    }
    
    .crop-modal .size-value {
      min-width: 40px;
      text-align: center;
      font-size: 14px;
      color: var(--muted);
    }

    /* PROFILE CARD STYLES */
    .profile-card {
      text-align: center;
      margin-bottom: 20px;
    }
    
    .avatar-wrap {
      position: relative;
      display: inline-block;
      margin-bottom: 16px;
    }
    
    .avatar-img {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 4px solid var(--primary);
      box-shadow: 0 0 20px rgba(var(--primary-rgb), 0.4);
    }
    
    .avatar-change-btn {
      position: absolute;
      bottom: 5px;
      right: 5px;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--primary);
      border: 2px solid var(--bg-card);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.2s;
    }
    
    .avatar-change-btn:hover {
      transform: scale(1.1);
      background: var(--primary-600);
    }
    
    .profile-display-name {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
    }
    
    .profile-display-bio {
      color: var(--muted);
      font-size: 16px;
      max-width: 300px;
      margin: 0 auto;
    }

    /* MODE LITE UNTUK PERANGKAT RENDAH */
    .lite-mode * {
      animation: none !important;
      transition: none !important;
    }

    .lite-mode .logo-neon {
      animation: none !important;
    }

    .lite-mode header {
      backdrop-filter: none !important;
      background: linear-gradient(180deg, rgba(30,41,59,0.95), rgba(30,41,59,0.90)) !important;
    }

    .lite-mode .modal {
      backdrop-filter: none !important;
    }

    .lite-mode .menu-drawer {
      backdrop-filter: none !important;
    }

    .lite-mode .form-section,
    .lite-mode .stats-section,
    .lite-mode .about-section {
      backdrop-filter: none !important;
    }

    .lite-mode .task-card,
    .lite-mode .schedule-item,
    .lite-mode .note-card,
    .lite-mode .stat-card {
      backdrop-filter: none !important;
    }

    /* UNTUK TEMA TERANG */
    .lite-mode.light-mode header {
      background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.90)) !important;
    }

    /* CALENDAR STYLES */
    .calendar-section {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      animation: fadeUp 0.5s ease-out;
    }
    
    .calendar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
    }
    
    .calendar-day {
      aspect-ratio: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      background: var(--bg-card);
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      padding: 4px;
    }
    
    .calendar-day:hover {
      background: var(--primary);
      color: white;
    }
    
    .calendar-day.today {
      background: var(--primary);
      color: white;
      box-shadow: 0 0 10px var(--primary);
    }
    
    .calendar-day.has-task::after {
      content: '';
      position: absolute;
      bottom: 4px;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--success);
    }
    
    .calendar-day.has-overdue::after {
      background: var(--danger);
    }
    
    .calendar-day.has-note::before {
      content: '';
      position: absolute;
      top: 4px;
      right: 4px;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--primary);
    }
    
    .calendar-day-header {
      font-weight: 600;
      text-align: center;
      margin-bottom: 8px;
      color: var(--muted);
    }
    
    /* PRODUCTIVITY CARD STYLES */
    .productivity-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      animation: fadeUp 0.5s ease-out;
    }
    
    .pomodoro-timer {
      text-align: center;
      margin: 20px 0;
    }
    
    .timer-display {
      font-size: 48px;
      font-weight: 700;
      margin: 20px 0;
      background: linear-gradient(135deg, var(--primary), var(--primary-600));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .timer-controls {
      display: flex;
      gap: 12px;
      justify-content: center;
    }
    
    .timer-mode {
      display: flex;
      background: var(--bg-card);
      border-radius: 12px;
      padding: 4px;
      margin: 16px 0;
    }
    
    .timer-mode-btn {
      flex: 1;
      padding: 8px;
      border: none;
      background: transparent;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }
    
    .timer-mode-btn.active {
      background: var(--primary);
      color: white;
    }
    
    /* TIMER SETTINGS STYLES */
    .timer-settings {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid rgba(255,255,255,0.1);
    }
    
    .timer-settings h4 {
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .timer-settings .field {
      margin-bottom: 12px;
    }
    
    .timer-settings .field label {
      font-size: 14px;
      margin-bottom: 4px;
    }
    
    .timer-settings .field input {
      padding: 8px 12px;
      font-size: 14px;
    }
    
    /* SEARCH SECTION */
    .search-section {
      background: var(--card);
      border-radius: var(--radius);
      padding: 16px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      animation: fadeUp 0.5s ease-out;
    }
    
    .search-input {
      width: 100%;
      padding: 12px 16px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.1);
      background: var(--glass);
      font-family: inherit;
      font-size: 15px;
      outline: 0;
      color: inherit;
    }
    
    /* PROGRESS BAR */
    .progress-bar {
      height: 8px;
      background: var(--bg-card);
      border-radius: 4px;
      overflow: hidden;
      margin: 12px 0;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--primary-600));
      border-radius: 4px;
      transition: width 0.3s ease;
    }
    
    /* ANIMATIONS */
    @keyframes slideDown {
      from {
        transform: translateY(-20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
    
    @keyframes fadeUp {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
    
    @keyframes slideUp {
      from {
        transform: translate(-50%, 20px);
        opacity: 0;
      }
      to {
        transform: translate(-50%, 0);
        opacity: 1;
      }
    }
    
    @keyframes modalSlideIn {
      from {
        transform: scale(0.9);
        opacity: 0;
      }
      to {
        transform: scale(1);
        opacity: 1;
      }
    }
    
    @keyframes pulse {
      0% {
        box-shadow: 0 0 0 0 rgba(var(--primary-rgb), 0.7);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(var(--primary-rgb), 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(var(--primary-rgb), 0);
      }
    }

    /* SETTINGS MODAL STYLES */
    .setting-group {
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .setting-group h4 {
      margin-bottom: 12px;
      font-weight: 600;
    }
    
    .setting-group .field {
      margin-bottom: 12px;
    }
    
    .setting-group .field label {
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
    }
    
    .setting-group .field input[type="checkbox"] {
      width: auto;
    }
    
    /* TIPS MODAL STYLES */
    .tips-content {
      line-height: 1.6;
    }
    
    .tip-item {
      margin-bottom: 16px;
      padding: 12px;
      border-radius: 8px;
      background: rgba(255,255,255,0.05);
    }
    
    .tip-item h4 {
      margin-bottom: 8px;
      color: var(--primary);
    }
    
    /* NOTE COLOR STYLES */
    .note-red { border-left: 4px solid #ef4444; }
    .note-blue { border-left: 4px solid #3b82f6; }
    .note-green { border-left: 4px solid #10b981; }
    .note-yellow { border-left: 4px solid #f59e0b; }
    .note-purple { border-left: 4px solid #8b5cf6; }
    
    /* NOTIFICATION MODAL STYLES - DIPERBARUI */
    .notification-container {
      position: relative;
      overflow: hidden;
      margin-bottom: 10px;
      border-radius: 8px;
      background: rgba(255,255,255,0.05);
      border-left: 4px solid transparent;
      transition: all 0.3s ease;
    }
    
    .notification-container.unread {
      border-left-color: var(--primary);
      background: rgba(var(--primary-rgb), 0.05);
    }
    
    .notification-item {
      padding: 12px;
      display: flex;
      align-items: center;
      gap: 12px;
      position: relative;
      transition: transform 0.3s ease;
      background: var(--card);
      cursor: pointer;
    }
    
    .notification-item.swipe-out {
      transform: translateX(-100%);
      opacity: 0;
    }
    
    .notification-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      flex-shrink: 0;
    }
    
    .notification-content {
      flex: 1;
    }
    
    .notification-title {
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .notification-time {
      font-size: 12px;
      color: var(--muted);
    }
    
    .icon-btn.small {
      width: 32px;
      height: 32px;
      font-size: 14px;
    }
    
    /* ANIMASI NOTIFIKASI BARU */
    @keyframes slideInNotification {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .notification-new {
      animation: slideInNotification 0.3s ease-out;
    }
    
    /* PRO DASHBOARD STYLES */
    .pro-dashboard {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    
    .pro-card {
      background: var(--card);
      border-radius: var(--radius);
      padding: 20px;
      box-shadow: var(--shadow);
      animation: fadeUp 0.5s ease-out;
      backdrop-filter: blur(5px);
    }
    
    .pro-card h3 {
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .pro-badge {
      background: linear-gradient(135deg, #FFD700, #D4AF37);
      color: #000;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 10px;
      font-weight: 700;
      margin-left: 8px;
    }
    
    /* HABIT TRACKER STYLES */
    .habit-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      margin-top: 16px;
    }
    
    .habit-day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      background: var(--bg-card);
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .habit-day.completed {
      background: var(--success);
      color: white;
    }
    
    .habit-day.skipped {
      background: var(--muted);
      opacity: 0.5;
    }
    
    /* VOICE NOTES STYLES */
    .voice-note-card {
      background: var(--card);
      padding: 18px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      margin-bottom: 16px;
      position: relative;
      transition: all 0.2s ease;
      animation: fadeUp 0.5s ease-out;
    }
    
    .voice-note-player {
      display: flex;
      align-items: center;
      gap: 12px;
      margin: 12px 0;
    }
    
    .voice-play-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary);
      border: none;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .voice-play-btn:hover {
      transform: scale(1.05);
    }
    
    .voice-progress {
      flex: 1;
      height: 6px;
      background: var(--bg-card);
      border-radius: 3px;
      overflow: hidden;
      position: relative;
    }
    
    .voice-progress-fill {
      height: 100%;
      background: var(--primary);
      border-radius: 3px;
      transition: width 0.1s;
    }
    
    .voice-duration {
      font-size: 12px;
      color: var(--muted);
      min-width: 40px;
      text-align: center;
    }
    
    /* DATE NOTE STYLES */
    .date-note-modal .note-form {
      margin-top: 16px;
    }
    
    .date-note-modal .note-preview {
      margin-top: 16px;
      padding: 12px;
      border-radius: 8px;
      background: rgba(255,255,255,0.05);
    }
    
    .date-note-modal .note-preview h4 {
      margin-bottom: 8px;
    }
    
    .calendar-tip {
      text-align: center;
      margin-top: 16px;
      padding: 12px;
      border-radius: 8px;
      background: rgba(255,255,255,0.05);
      font-size: 14px;
      color: var(--muted);
    }
    
    /* PWA INSTALL BUTTON */
    .install-promotion {
      position: fixed;
      bottom: 180px;
      left: 20px;
      z-index: 1000;
      background: linear-gradient(135deg, var(--primary), var(--primary-600));
      color: white;
      padding: 12px 18px;
      border-radius: 25px;
      font-weight: 600;
      font-size: 14px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.3);
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
    }
    
    .install-promotion:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(0,0,0,0.4);
    }
    
    .pwa-mode .install-promotion {
      display: none;
    }
    
    /* PERBAIKAN UNTUK PWA */
    @media (display-mode: standalone) {
      body {
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
      }
      
      header {
        margin-top: env(safe-area-inset-top);
      }
    }
    
    /* RESPONSIVE */
    @media (max-width: 768px) {
      .header-actions {
        position: relative;
      }
      
      .brand h1 {
        font-size: 18px;
      }
      
      .logo {
        width: 36px;
        height: 36px;
      }
      
      .btn, .filter-btn {
        padding: 10px 14px;
        font-size: 13px;
      }
      
      .task-title {
        font-size: 16px;
      }
      
      .task-detail {
        font-size: 13px;
      }
      
      .fab {
        width: 56px;
        height: 56px;
        font-size: 22px;
        bottom: 80px;
      }
      
      .priority-badge {
        font-size: 10px;
        padding: 3px 6px;
      }
      
      .task-actions {
        flex-wrap: wrap;
      }
      
      .menu-drawer {
        width: 85%;
      }
      
      .timer-display {
        font-size: 36px;
      }
      
      .notification-item {
        padding: 10px;
      }

      /* MOBILE OPTIMIZATION - REDUCE BLUR EFFECTS */
      header {
        backdrop-filter: none !important;
        background: linear-gradient(180deg, rgba(30,41,59,0.95), rgba(30,41,59,0.90)) !important;
      }

      .light-mode header {
        background: linear-gradient(180deg, rgba(255,255,255,0.95), rgba(255,255,255,0.90)) !important;
      }

      .modal {
        backdrop-filter: none !important;
      }

      .menu-drawer {
        backdrop-filter: none !important;
      }

      .form-section,
      .stats-section,
      .about-section {
        backdrop-filter: none !important;
      }

      .task-card,
      .schedule-item,
      .note-card,
      .stat-card {
        backdrop-filter: none !important;
      }

      /* TAB NAVIGATION SCROLLABLE ON MOBILE */
      .tab-navigation {
        overflow-x: auto;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none; /* FIREFOX */
      }
      
      .tab-navigation::-webkit-scrollbar {
        display: none; /* CHROME, SAFARI, EDGE */
      }
      
      .tab-btn {
        flex: none;
        min-width: 100px;
      }
      
      .pro-dashboard {
        grid-template-columns: 1fr;
      }
      
      .schedule-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      .schedule-time {
        min-width: auto;
      }
      
      .schedule-desc {
        margin-right: 0;
      }
      
      .install-promotion {
        bottom: 160px;
        left: 50%;
        transform: translateX(-50%);
        width: 90%;
        max-width: 300px;
        text-align: center;
        justify-content: center;
      }
    }
    
    @media (min-width: 769px) {
      .container {
        max-width: 1200px;
        padding: 20px;
      }
      
      .tab-navigation {
        justify-content: center;
      }
      
      .tab-btn {
        flex: none;
        min-width: 120px;
      }
      
      .pro-dashboard {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .task-actions {
        justify-content: flex-start;
      }
      
      .schedule-item {
        align-items: center;
      }
    }
    
    @media (max-width: 480px) {
      .brand {
        gap: 8px;
      }
      
      .header-actions {
        justify-content: flex-end;
        width: 100%;
        margin-top: 8px;
      }
      
      .controls {
        justify-content: space-between;
        width: 100%;
      }
      
      .filter-section {
        gap: 6px;
      }
      
      .filter-btn {
        padding: 8px 12px;
        font-size: 13px;
      }
      
      .schedule-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      
      .schedule-time {
        min-width: auto;
      }
      
      .task-title {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
      }
      
      .priority-badge {
        margin-left: 0;
      }
      
      .task-detail {
        flex-direction: column;
        align-items: flex-start;
        gap: 4px;
      }
      
      .note-title, .note-content {
        word-break: break-word;
      }
      
      .chart-container {
        height: 180px !important;
      }
      
      .menu-drawer {
        width: 90%;
      }

      .avatar-img {
        width: 100px;
        height: 100px;
      }

      .profile-display-name {
        font-size: 20px;
      }

      .profile-display-bio {
        font-size: 14px;
      }
      
      .calendar-grid {
        gap: 4px;
      }
      
      .timer-display {
        font-size: 32px;
      }
      
      .voice-note-player {
        flex-direction: column;
        gap: 8px;
      }
      
      .voice-progress {
        width: 100%;
      }
    }

    /* SWIPE GESTURE STYLES */
    .swipeable-item {
      position: relative;
      overflow: hidden;
      transition: transform 0.3s ease;
    }
    
    .swipeable-item.swiping {
      transition: none;
    }
    
    .swipeable-item.swipe-out {
      transform: translateX(-100%);
      opacity: 0;
    }
    
    /* CONTACT LIST STYLES */
    .contact-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 16px;
    }
    
    .contact-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: 10px;
      background: rgba(255,255,255,0.05);
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .contact-item:hover {
      background: rgba(255,255,255,0.1);
      transform: translateY(-2px);
    }
    
    .contact-icon {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(255,255,255,0.1);
    }
    
    .contact-icon img {
      width: 24px;
      height: 24px;
    }
    
    .contact-info {
      flex: 1;
    }
    
    .contact-label {
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .contact-value {
      font-size: 14px;
      color: var(--muted);
    }
  </style>
</head>
<body class="midnight-tech-mode">
  <!-- Splash Screen -->
  <div id="splash" style="position:fixed;inset:0;z-index:9999;background:#000;display:flex;align-items:center;justify-content:center;">
    <img src="splash.png" alt="Splash" style="width:100%;height:100%;object-fit:cover;">
  </div>

  <!-- Main Content -->
  <div id="mainContent" style="display:none;">
    <div class="container">
      <!-- Header -->
      <header>
        <div class="brand">
          <div class="logo logo-neon">
            <img src="my-icon.png" alt="App Icon" class="app-icon">
          </div>
          <h1>TugasKu <span class="pro-badge">PRO</span></h1>
        </div>
        <div class="header-actions">
          <!-- Notifikasi -->
          <button class="icon-btn" id="notifBtn" title="Notifikasi" aria-label="Notifikasi" style="position:relative;">
            
            <span class="badge" id="notifBadge" style="display:none;">0</span>
          </button>
          <!-- Statistik -->
          <button class="icon-btn" id="statsBtn" title="Statistik" aria-label="Statistik"></button>
          <!-- Menu Hamburger -->
          <button class="icon-btn" id="menuBtn" title="Menu" aria-label="Menu">
            <svg width="24" height="24" stroke="currentColor" fill="none">
              <path d="M3 6h18M3 12h18M3 18h18"/>
            </svg>
          </button>
        </div>
      </header>
      
      <!-- Menu Drawer -->
      <div class="menu-drawer" id="menuDrawer">
        <div class="menu-header">
          <h3>Menu PRO</h3>
          <button class="menu-close" id="menuClose">&times;</button>
        </div>
        
        <!-- Profile Section -->
        <div class="profile-section" id="profileSection">
          <div class="profile-avatar" id="profileAvatar"></div>
          <div class="profile-info">
            <div class="profile-name" id="profileName">Pengguna TugasKu</div>
            <div class="profile-desc" id="profileDesc">Pelajar Aktif</div>
          </div>
        </div>
        
        <div class="menu-divider"></div>
        
        <!-- Menu Items - Web Utama dipindah ke sini dengan gaya mencolok -->
        <div class="menu-item menu-item-highlight" data-action="portfolio" title="Kunjungi Portofolio Rahmat">
          <span>&lt;/&gt;</span> Kunjungi Web Utama
        </div>
        
        <div class="menu-divider"></div>
        
        <!-- Menu Hubungi Kami -->
        <div class="menu-item" data-action="contact">
          <span></span> Hubungi Kami
        </div>
        
        <div class="menu-divider"></div>
        
        <div class="menu-item" data-action="profile">
          <span></span> Profil Saya
        </div>
        <div class="menu-item" data-action="settings">
          <span></span> Pengaturan
        </div>
        <div class="menu-item" data-action="tips">
          <span></span> Tips & Panduan
        </div>
        <div class="menu-item" data-action="focus">
          <span></span> Mode Fokus
        </div>
        <div class="menu-item" data-action="backup">
          <span></span> Cadangan Otomatis
        </div>
        
        <div class="menu-divider"></div>
        
        <div class="menu-item" data-action="export">
          <span></span> Ekspor Data
        </div>
        <div class="menu-item" data-action="import">
          <span></span> Impor Data
        </div>
        
        <div class="menu-divider"></div>
        
        <div class="menu-item" data-action="theme">
          <span></span> Pilih Tema
        </div>
        <div class="menu-item" data-action="about">
          <span></span> Tentang Aplikasi
        </div>
        <div class="menu-item" data-action="reset">
          <span></span> Reset Data
        </div>
      </div>
      
      <!-- Tab Navigation -->
      <div class="tab-navigation">
        <button class="tab-btn active" data-tab="dashboard">Dashboard</button>
        <button class="tab-btn" data-tab="tasks">Tugas</button>
        <button class="tab-btn" data-tab="schedule">Jadwal</button>
        <button class="tab-btn" data-tab="notes">Catatan</button>
        <button class="tab-btn" data-tab="calendar">Kalender</button>
        <button class="tab-btn" data-tab="productivity">Produktivitas</button>
      </div>
      
      <!-- Tab Content: Dashboard PRO -->
      <div class="tab-content active" id="dashboardTab">
        <div class="pro-dashboard">
          <!-- Statistik Cepat -->
          <div class="pro-card">
            <h3> Ringkasan Produktivitas</h3>
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-value" id="dashboardTotalTasks">0</div>
                <div class="stat-label">Total Tugas</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="dashboardCompleted">0</div>
                <div class="stat-label">Selesai</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="dashboardFocusTime">0</div>
                <div class="stat-label">Jam Fokus</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="dashboardProductivity">0%</div>
                <div class="stat-label">Produktivitas</div>
              </div>
            </div>
          </div>
          
          <!-- Tugas Mendesak -->
          <div class="pro-card">
            <h3> Tugas Mendesak</h3>
            <div id="urgentTasksList">
              <div class="empty-state">
                <p>Tidak ada tugas mendesak</p>
              </div>
            </div>
          </div>
          
          <!-- Aktivitas Terbaru -->
          <div class="pro-card">
            <h3> Aktivitas Terbaru</h3>
            <div class="chart-wrap">
              <div class="chart-container">
                <canvas id="dashboardActivityChart"></canvas>
              </div>
            </div>
          </div>
          
          <!-- Pencapaian -->
          <div class="pro-card">
            <h3> Pencapaian</h3>
            <div id="achievementsList">
              <div class="empty-state">
                <p>Belum ada pencapaian</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Tab Content: Tugas -->
      <div class="tab-content" id="tasksTab">
        <!-- Stats Section -->
        <section class="stats-section">
          <h3> Statistik Tugas</h3>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-value" id="totalTasksHome">0</div>
              <div class="stat-label">Total Tugas</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="completedTasksHome">0</div>
              <div class="stat-label">Selesai</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="pendingTasksHome">0</div>
              <div class="stat-label">Belum Selesai</div>
            </div>
            <div class="stat-card">
              <div class="stat-value" id="overdueTasksHome">0</div>
              <div class="stat-label">Terlambat</div>
            </div>
          </div>
          <div class="chart-wrap">
            <div class="chart-container">
              <canvas id="homeTaskChart"></canvas>
            </div>
          </div>
        </section>
        
        <!-- Filter Section -->
        <div class="filter-section">
          <button class="filter-btn active" data-filter="all">Semua</button>
          <button class="filter-btn" data-filter="pending">Belum Selesai</button>
          <button class="filter-btn" data-filter="completed">Selesai</button>
          <button class="filter-btn" data-filter="overdue">Terlambat</button>
          <button class="filter-btn" data-filter="high">Prioritas Tinggi</button>
          <button class="filter-btn" data-filter="today">Hari Ini</button>
        </div>
        
        <!-- Search Section -->
        <div class="search-section">
          <input type="text" class="search-input" id="taskSearch" placeholder="Cari tugas...">
        </div>
        
        <!-- Tasks List -->
        <div id="tasksList">
          <div class="empty-state">
            <h3>Belum ada tugas</h3>
            <p>Tambahkan tugas pertama Anda dengan tombol + di bawah</p>
          </div>
        </div>
      </div>
      
      <!-- Tab Content: Jadwal -->
      <div class="tab-content" id="scheduleTab">
        <div class="form-section">
          <h3>Tambah Jadwal</h3>
          <div class="field">
            <label>Hari</label>
            <select id="scheduleDay">
              <option value="senin">Senin</option>
              <option value="selasa">Selasa</option>
              <option value="rabu">Rabu</option>
              <option value="kamis">Kamis</option>
              <option value="jumat">Jumat</option>
              <option value="sabtu">Sabtu</option>
              <option value="minggu">Minggu</option>
            </select>
          </div>
          <div class="field">
            <label>Waktu</label>
            <input type="time" id="scheduleTime">
          </div>
          <div class="field">
            <label>Mata Pelajaran/Kegiatan</label>
            <input type="text" id="scheduleSubject" placeholder="Contoh: Matematika">
          </div>
          <div class="field">
            <label>Deskripsi</label>
            <textarea id="scheduleDesc" rows="2" placeholder="Opsional"></textarea>
          </div>
          <div class="controls">
            <button class="btn" id="addScheduleBtn">Tambah Jadwal</button>
          </div>
        </div>
        
        <div id="scheduleList">
          <div class="empty-state">
            <h3>Belum ada jadwal</h3>
            <p>Tambahkan jadwal mingguan Anda</p>
          </div>
        </div>
      </div>
      
      <!-- Tab Content: Catatan -->
      <div class="tab-content" id="notesTab">
        <div class="form-section">
          <h3>Tambah Catatan</h3>
          <div class="field">
            <label>Judul</label>
            <input type="text" id="noteTitle" placeholder="Judul catatan">
          </div>
          <div class="field">
            <label>Isi</label>
            <textarea id="noteContent" rows="5" placeholder="Tulis catatan Anda di sini..."></textarea>
          </div>
          <div class="field">
            <label>Warna</label>
            <select id="noteColor">
              <option value="">Default</option>
              <option value="red">Merah</option>
              <option value="blue">Biru</option>
              <option value="green">Hijau</option>
              <option value="yellow">Kuning</option>
              <option value="purple">Ungu</option>
            </select>
          </div>
          <div class="field">
            <label>
              <input type="checkbox" id="notePinned"> Pin catatan (tampilkan di atas)
            </label>
          </div>
          <div class="controls">
            <button class="btn" id="addNoteBtn">Tambah Catatan</button>
          </div>
        </div>
        
        <div id="notesList">
          <div class="empty-state">
            <h3>Belum ada catatan</h3>
            <p>Tambahkan catatan pertama Anda</p>
          </div>
        </div>
      </div>
      
      <!-- Tab Content: Kalender -->
      <div class="tab-content" id="calendarTab">
        <div class="calendar-section">
          <div class="calendar-header">
            <button class="icon-btn" id="prevMonth"></button>
            <h3 id="currentMonth">Januari 2023</h3>
            <button class="icon-btn" id="nextMonth"></button>
          </div>
          <div class="calendar-tip">
             Ketuk dua kali pada tanggal untuk menambah atau melihat catatan tanggal
          </div>
          <div class="calendar-grid" id="calendarGrid">
            <!-- Calendar will be generated by JavaScript -->
          </div>
        </div>
        
        <div class="form-section">
          <h3>Tugas untuk <span id="selectedDate">-</span></h3>
          <div id="selectedDateTasks">
            <p>Pilih tanggal untuk melihat tugas</p>
          </div>
        </div>
      </div>
      
      <!-- Tab Content: Produktivitas -->
      <div class="tab-content" id="productivityTab">
        <div class="productivity-card">
          <h3> Fokus Timer PRO</h3>
          <div class="timer-mode">
            <button class="timer-mode-btn active" data-mode="focus">Fokus</button>
            <button class="timer-mode-btn" data-mode="short">Istirahat Pendek</button>
            <button class="timer-mode-btn" data-mode="long">Istirahat Panjang</button>
          </div>
          <div class="pomodoro-timer">
            <div class="timer-display" id="timerDisplay">25:00</div>
            <div class="timer-controls">
              <button class="btn" id="startTimer">Mulai</button>
              <button class="btn" id="pauseTimer">Jeda</button>
              <button class="btn" id="resetTimer">Reset</button>
          </div>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="timerProgress" style="width: 0%"></div>
        </div>
        
        <!-- Pengaturan Timer Langsung -->
        <div class="timer-settings">
          <h4> Pengaturan Timer</h4>
          <div class="field">
            <label>Durasi Fokus (menit):</label>
            <input type="number" id="focusDurationSetting" min="1" placeholder="Masukkan menit">
          </div>
          <div class="field">
            <label>Durasi Istirahat Pendek (menit):</label>
            <input type="number" id="shortBreakDurationSetting" min="1" placeholder="Masukkan menit">
          </div>
          <div class="field">
            <label>Durasi Istirahat Panjang (menit):</label>
            <input type="number" id="longBreakDurationSetting" min="1" placeholder="Masukkan menit">
          </div>
          <button class="btn" id="saveTimerSettings">Simpan Pengaturan Timer</button>
        </div>
      </div>
      
      <div class="stats-section">
        <h3> Statistik Produktivitas PRO</h3>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="todayPomodoros">0</div>
            <div class="stat-label">Fokus Hari Ini</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="weekPomodoros">0</div>
            <div class="stat-label">Fokus Minggu Ini</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="totalPomodoros">0</div>
            <div class="stat-label">Total Fokus</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="focusTime">0</div>
            <div class="stat-label">Jam Fokus</div>
          </div>
        </div>
        <div class="chart-wrap">
          <div class="chart-container">
            <canvas id="productivityChart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- FAB -->
  <button class="fab" id="addTaskBtn">+</button>
  
  <!-- Toast -->
  <div class="toast" id="toast"></div>
  
  <!-- Watermark -->
  <div class="watermark">TugasKu PRO v5.9.2</div>
</div>

<!-- Task Modal -->
<div class="modal-overlay" id="taskModal">
  <div class="modal">
    <div class="modal-header">
      <h3 id="taskModalTitle">Tambah Tugas Baru</h3>
      <button class="modal-close" id="taskModalClose">&times;</button>
    </div>
    <form id="taskForm">
      <div class="field">
        <label>Judul Tugas</label>
        <input type="text" id="taskTitle" required placeholder="Contoh: Mengerjakan PR Matematika">
      </div>
      <div class="field">
        <label>Deskripsi</label>
        <textarea id="taskDesc" rows="3" placeholder="Detail tugas (opsional)"></textarea>
      </div>
      <div class="field">
        <label>Deadline</label>
        <input type="date" id="taskDeadline">
      </div>
      <div class="field">
        <label>Prioritas</label>
        <select id="taskPriority">
          <option value="low">Rendah</option>
          <option value="medium" selected>Sedang</option>
          <option value="high">Tinggi</option>
        </select>
      </div>
      <div class="field">
        <label>Kategori</label>
        <input type="text" id="taskCategory" placeholder="Contoh: Sekolah, Pribadi">
      </div>
      <div class="controls">
        <button type="button" class="btn" id="cancelTaskBtn">Batal</button>
        <button type="submit" class="btn" id="saveTaskBtn">Simpan</button>
      </div>
    </form>
  </div>
</div>

<!-- Stats Modal -->
<div class="modal-overlay" id="statsModal">
  <div class="modal">
    <div class="modal-header">
      <h3>Statistik Lengkap PRO</h3>
      <button class="modal-close" id="statsModalClose">&times;</button>
    </div>
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="totalTasks">0</div>
        <div class="stat-label">Total Tugas</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="completedTasks">0</div>
        <div class="stat-label">Selesai</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="pendingTasks">0</div>
        <div class="stat-label">Belum Selesai</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="overdueTasks">0</div>
        <div class="stat-label">Terlambat</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="todayTasks">0</div>
        <div class="stat-label">Tugas Hari Ini</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="weekTasks">0</div>
        <div class="stat-label">Tugas Minggu Ini</div>
      </div>
    </div>
    <div class="chart-wrap">
      <div class="chart-container">
        <canvas id="taskChart"></canvas>
      </div>
    </div>
    <div class="chart-wrap">
      <div class="chart-container">
        <canvas id="priorityChart"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- Theme Modal -->
<div class="modal-overlay" id="themeModal">
  <div class="modal">
    <div class="modal-header">
      <h3>Pilih Tema PRO</h3>
      <button class="modal-close" id="themeModalClose">&times;</button>
    </div>
    <div class="theme-option" data-theme="dark">
      <div class="theme-preview" style="background: #1e293b; color: white;"></div>
      <div>
        <div>Gelap Standar</div>
        <small>Tema gelam dengan aksen ungu</small>
      </div>
    </div>
    <div class="theme-option" data-theme="light">
      <div class="theme-preview" style="background: #ffffff; color: #333;"></div>
      <div>
        <div>Terang</div>
        <small>Tema terang yang nyaman di mata</small>
      </div>
    </div>
    <div class="theme-option" data-theme="dark-pro">
      <div class="theme-preview" style="background: #0b0f16; color: #00c8ff;"></div>
      <div>
        <div>Gelap Profesional</div>
        <small>Tema gelap dengan aksen biru neon</small>
      </div>
    </div>
    <div class="theme-option" data-theme="dark-pro-shift">
      <div class="theme-preview" style="background: #0f172a; color: #8B5CF6;"></div>
      <div>
        <div>Gelap Profesional Shift</div>
        <small>Tema gelap dengan aksen ungu neon</small>
      </div>
    </div>
    <div class="theme-option" data-theme="midnight-tech">
      <div class="theme-preview" style="background: #0f172a; color: #38bdf8;"></div>
      <div>
        <div>Midnight Tech</div>
        <small>Tema gelap dengan aksen biru techy</small>
      </div>
    </div>
    <div class="theme-option" data-theme="carbon-blue">
      <div class="theme-preview" style="background: #1e293b; color: #3b82f6;"></div>
      <div>
        <div>Carbon Blue</div>
        <small>Tema gelap dengan aksen biru elegan</small>
      </div>
    </div>
    <div class="theme-option" data-theme="cyber-gray">
      <div class="theme-preview" style="background: #111827; color: #22d3ee;"></div>
      <div>
        <div>Cyber Gray</div>
        <small>Tema futuristic dengan aksen cyan</small>
      </div>
    </div>
    <div class="theme-option" data-theme="blue-mist">
      <div class="theme-preview" style="background: #0a192f; color: #64ffda;"></div>
      <div>
        <div>Blue Mist</div>
        <small>Tema gelap dengan aksen hijau kebiruan</small>
      </div>
    </div>
    <div class="theme-option" data-theme="pink-elegant">
      <div class="theme-preview" style="background: #2d1b3e; color: #ec4899;"></div>
      <div>
        <div>Pink Elegant</div>
        <small>Tema elegan dengan aksen pink untuk wanita</small>
      </div>
    </div>
    <div class="theme-option" data-theme="pro-gold">
      <div class="theme-preview" style="background: #2d2d2d; color: #FFD700;"></div>
      <div>
        <div>PRO Gold</div>
        <small>Tema premium dengan aksen emas</small>
      </div>
    </div>
    <div class="theme-option" data-theme="pro-forest">
      <div class="theme-preview" style="background: #1a2f1a; color: #2A9D8F;"></div>
      <div>
        <div>PRO Forest</div>
        <small>Tema hutan dengan aksen hijau</small>
      </div>
    </div>
    <div class="theme-option" data-theme="neon-dark">
      <div class="theme-preview" style="background: #0a0a0a; color: #ff00ff;"></div>
      <div>
        <div>Neon Dark</div>
        <small>Tema gelap dengan aksen neon magenta</small>
      </div>
    </div>
    <div class="theme-option" data-theme="sunset-vibes">
      <div class="theme-preview" style="background: #1a1a2e; color: #FF6B6B;"></div>
      <div>
        <div>Sunset Vibes</div>
        <small>Tema dengan gradien sunset yang menenangkan</small>
      </div>
    </div>
  </div>
</div>

<!-- Profile Modal -->
<div class="modal-overlay" id="profileModal">
  <div class="modal profile-modal">
    <div class="modal-header">
      <h3>Profil Saya PRO</h3>
      <button class="modal-close" id="profileModalClose">&times;</button>
    </div>
    
    <!-- Profile Display Section -->
    <div class="profile-section" id="profileDisplay" style="flex-direction: column; text-align: center; gap: 16px;">
      <div class="avatar-container" style="position: relative; display: inline-block;">
        <img src="" alt="Avatar" class="avatar" id="profileAvatarImg" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid var(--primary); box-shadow: 0 0 20px rgba(var(--primary-rgb), 0.4);">
        <div class="avatar-edit-btn" id="changeAvatarBtn" style="position: absolute; bottom: 5px; right: 5px; width: 36px; height: 36px; border-radius: 50%; background: var(--primary); border: 2px solid var(--bg-card); display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 16px; transition: all 0.2s;">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
        </div>
      </div>
      
      <div style="width: 100%;">
        <h2 class="profile-name" id="profileDisplayName" style="margin: 0 0 8px; font-size: 24px; font-weight: 700;">Nama Pengguna</h2>
        <p class="profile-title" id="profileDisplayTitle" style="margin: 0 0 8px; color: var(--muted); font-size: 16px;">Jabatan</p>
        <p class="profile-bio" id="profileDisplayBio" style="margin: 0; color: var(--muted); font-size: 14px; line-height: 1.4;">Bio Pengguna</p>
      </div>
      
      <div class="profile-stats" style="display: flex; justify-content: space-around; width: 100%; margin: 16px 0;">
        <div class="stat-item" style="text-align: center;">
          <div class="stat-value" id="statTasksCompleted" style="font-size: 24px; font-weight: bold;">0</div>
          <div class="stat-label" style="font-size: 14px; color: var(--muted);">Tugas Selesai</div>
        </div>
        <div class="stat-item" style="text-align: center;">
          <div class="stat-value" id="statActiveProjects" style="font-size: 24px; font-weight: bold;">0</div>
          <div class="stat-label" style="font-size: 14px; color: var(--muted);">Proyek Aktif</div>
        </div>
        <div class="stat-item" style="text-align: center;">
          <div class="stat-value" id="statCompletionRate" style="font-size: 24px; font-weight: bold;">0%</div>
          <div class="stat-label" style="font-size: 14px; color: var(--muted);">Tingkat Penyelesaian</div>
        </div>
      </div>
      
      <div class="profile-actions" style="display: flex; gap: 12px; width: 100%;">
        <button class="btn" id="editProfileBtn" style="flex: 1;">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
          Edit Profil
        </button>
        <button class="btn btn-danger" id="deleteProfileBtn" style="flex: 1;">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
          Hapus Foto Profil
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Profile Modal -->
<div class="modal-overlay" id="editProfileModal">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">Edit Profil</h3>
      <button class="modal-close" id="editProfileModalClose">&times;</button>
    </div>
    
    <div class="field">
      <label for="editName">Nama Lengkap</label>
      <input type="text" id="editName" placeholder="Nama Anda">
    </div>
    
    <div class="field">
      <label for="editTitle">Jabatan</label>
      <input type="text" id="editTitle" placeholder="Jabatan Anda">
    </div>
    
    <div class="field">
      <label for="editBio">Bio</label>
      <textarea id="editBio" placeholder="Ceritakan tentang diri Anda"></textarea>
    </div>
    
    <div class="form-actions">
      <button class="btn btn-secondary" id="cancelEditProfileBtn">Batal</button>
      <button class="btn" id="saveEditProfileBtn">Simpan Perubahan</button>
    </div>
  </div>
</div>

<!-- Avatar Upload Modal -->
<div class="modal-overlay" id="avatarModal">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">Ubah Foto Profil</h3>
      <button class="modal-close" id="avatarModalClose">&times;</button>
    </div>
    
    <div class="avatar-upload-section" style="text-align: center;">
      <img src="" alt="Avatar Preview" class="avatar-preview" id="avatarPreview" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 4px solid var(--primary); margin-bottom: 16px;">
      
      <div class="upload-area" id="uploadArea" style="border: 2px dashed rgba(255,255,255,0.2); border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.2s;">
        <div class="upload-icon" style="font-size: 36px; margin-bottom: 8px;">
          <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="17 8 12 3 7 8"></polyline>
            <line x1="12" y1="3" x2="12" y2="15"></line>
          </svg>
        </div>
        <p class="upload-text" style="margin: 0; font-weight: 600;">Klik untuk mengunggah foto</p>
        <p class="upload-text" style="font-size: 12px; margin-top: 4px; color: var(--muted);">Format: JPG, PNG. Maks: 5MB</p>
      </div>
      <input type="file" id="avatarInput" accept="image/*" style="display: none;">
    </div>
    
    <div class="form-actions" style="display: flex; gap: 12px; margin-top: 20px;">
      <button class="btn btn-secondary" id="cancelAvatarBtn" style="flex: 1;">Batal</button>
      <button class="btn" id="saveAvatarBtn" style="flex: 1;">Simpan Foto</button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal-overlay" id="deleteModal">
  <div class="modal">
    <div class="modal-header">
      <h3 class="modal-title">Konfirmasi Hapus Foto Profil</h3>
      <button class="modal-close" id="deleteModalClose">&times;</button>
    </div>
    
    <p style="margin-bottom: 16px;">Apakah Anda yakin ingin menghapus foto profil ini?</p>
    
    <div class="form-actions" style="display: flex; gap: 12px;">
      <button class="btn btn-secondary" id="cancelDeleteBtn" style="flex: 1;">Batal</button>
      <button class="btn btn-danger" id="confirmDeleteBtn" style="flex: 1;">Hapus Foto Profil</button>
    </div>
  </div>
</div>

<!-- Settings Modal -->
<div class="modal-overlay" id="settingsModal">
  <div class="modal">
    <div class="modal-header">
      <h3>Pengaturan PRO</h3>
      <button class="modal-close" id="settingsModalClose">&times;</button>
    </div>
    <div class="settings-content">
      <div class="setting-group">
        <h4>Notifikasi</h4>
        <div class="field">
          <label>
            <input type="checkbox" id="notificationsEnabled"> Aktifkan Notifikasi
          </label>
        </div>
        <div class="field">
          <label>Peringatkan sebelum (hari):</label>
          <select id="notificationLeadDays">
            <option value="1">1 hari</option>
            <option value="2">2 hari</option>
            <option value="3">3 hari</option>
          </select>
        </div>
        <div class="field">
          <label>
            <input type="checkbox" id="useBrowserNotification"> Gunakan Notifikasi Browser
          </label>
        </div>
      </div>
      
      <div class="setting-group">
        <h4>Fitur Baru PRO</h4>
        <div class="field">
          <label>
            <input type="checkbox" id="autoSaveEnabled"> Simpan Otomatis
          </label>
        </div>
        <div class="field">
          <label>
            <input type="checkbox" id="quickActionsEnabled"> Tampilkan Aksi Cepat
          </label>
        </div>
        <div class="field">
          <label>
            <input type="checkbox" id="darkReaderEnabled"> Mode Baca Gelap
          </label>
        </div>
      </div>
      
      <div class="setting-group">
        <h4>Tampilan</h4>
        <div class="field">
          <label>
            <input type="checkbox" id="liteMode"> Mode Ringan (nonaktifkan animasi)
          </label>
        </div>
      </div>
      
      <div class="actions">
        <button class="btn" id="saveSettingsBtn">Simpan Pengaturan</button>
      </div>
    </div>
  </div>
</div>

<!-- Tips Modal -->
<div class="modal-overlay" id="tipsModal">
  <div class="modal">
    <div class="modal-header">
      <h3>Tips & Panduan PRO</h3>
      <button class="modal-close" id="tipsModalClose">&times;</button>
    </div>
    <div class="tips-content">
      <div class="tip-item">
        <h4> Kelola Tugas dengan Efisien</h4>
        <p>Gunakan fitur prioritas untuk mengurutkan tugas berdasarkan tingkat kepentingan. Tugas dengan prioritas tinggi akan ditandai dengan warna merah.</p>
      </div>
      <div class="tip-item">
        <h4> Manfaatkan Fokus Timer PRO</h4>
        <p>Gunakan timer fokus untuk meningkatkan produktivitas. Atur durasi sesuai kebutuhan dan istirahat sejenak setelah sesi fokus selesai.</p>
      </div>
      <div class="tip-item">
        <h4> Pantau Deadline dengan Kalender</h4>
        <p>Gunakan kalender untuk melihat tugas berdasarkan tanggal. Titik warna pada tanggal menandakan ada tugas yang harus diselesaikan.</p>
      </div>
      <div class="tip-item">
        <h4> Personalisasi Tampilan</h4>
        <p>Ubah tema aplikasi sesuai preferensi Anda. Tersedia tema gelap, terang, dan profesional dengan berbagai aksen warna.</p>
      </div>
      <div class="tip-item">
        <h4> Pantau Statistik Produktivitas</h4>
        <p>Lihat statistik untuk melacak kemajuan Anda. Grafik akan membantu Anda memahami pola produktivitas dari waktu ke waktu.</p>
      </div>
      <div class="tip-item">
        <h4> Aktifkan Notifikasi</h4>
        <p>Nyalakan notifikasi untuk mendapatkan pengingat tentang tugas yang mendekati deadline. Atur berapa hari sebelumnya Anda ingin diingatkan.</p>
      </div>
      <div class="tip-item">
        <h4> Optimalkan untuk Perangkat</h4>
        <p>Aktifkan mode ringan jika menggunakan perangkat dengan spesifikasi rendah. Mode ini akan menonaktifkan animasi untuk performa yang lebih baik.</p>
      </div>
      <div class="tip-item">
        <h4> Manfaatkan Fitur PRO</h4>
        <p>Dengan versi PRO, Anda mendapatkan akses ke dashboard analitik lengkap, tema premium, dan fitur-fitur produktivitas lanjutan.</p>
      </div>
    </div>
  </div>
</div>

<!-- About Modal -->
<div class="modal-overlay" id="aboutModal">
  <div class="modal">
    <div class="modal-header">
      <h3>Tentang Aplikasi PRO</h3>
      <button class="modal-close" id="aboutModalClose">&times;</button>
    </div>
    <div class="about-section">
      <div class="about-logo">
        <div class="logo">
          <img src="my-icon.png" alt="App Icon" class="app-icon">
        </div>
        <h2>TugasKu <span class="pro-badge">PRO</span></h2>
      </div>
      <p>TugasKu PRO adalah aplikasi manajemen tugas premium yang dirancang untuk membantu pelajar dan mahasiswa mengatur tugas, jadwal, dan meningkatkan produktivitas dengan fitur-fitur canggih.</p>
      <h4>Fitur Utama PRO:</h4>
      <ul class="feature-list">
        <li>Dashboard analitik lengkap dengan statistik real-time</li>
        <li>Manajemen tugas dengan prioritas dan deadline</li>
        <li>Jadwal mingguan terorganisir</li>
        <li>Catatan pribadi dengan warna dan pin</li>
        <li>Kalender integrasi dengan catatan tanggal</li>
        <li>Timer Fokus PRO untuk produktivitas maksimal</li>
        <li>Statistik produktivitas mendalam</li>
        <li>Tema premium eksklusif</li>
        <li>Backup dan restore data</li>
        <li>Notifikasi tugas mendekati deadline</li>
        <li>Profil pengguna dengan foto avatar</li>
        <li>Mode ringan untuk perangkat rendah</li>
        <li>Dukungan PWA - Dapat diinstall ke layar utama</li>
      </ul>
      <div class="version-info">
        <p>Versi: 5.9.2 PRO</p>
        <p>Dikembangkan dengan  oleh Tim TugasKu</p>
      </div>
    </div>
  </div>
</div>

<!-- Notifications Modal - DIPERBARUI -->
<div class="modal-overlay" id="notificationsModal">
  <div class="modal">
    <div class="modal-header">
      <h3>Notifikasi</h3>
      <button class="modal-close" id="notificationsModalClose">&times;</button>
    </div>
    <div class="notification-tip" style="padding: 10px; background: rgba(var(--primary-rgb), 0.1); border-radius: 8px; margin-bottom: 16px; font-size: 14px; color: var(--muted);">
       Geser ke kiri untuk menghapus notifikasi
    </div>
    <div id="notificationsList">
      <div class="empty-state">
        <h3>Tidak ada notifikasi</h3>
        <p>Notifikasi akan muncul di sini</p>
      </div>
    </div>
  </div>
</div>

<!-- Date Note Modal -->
<div class="modal-overlay" id="dateNoteModal">
  <div class="modal date-note-modal">
    <div class="modal-header">
      <h3 id="dateNoteModalTitle">Catatan Tanggal</h3>
      <button class="modal-close" id="dateNoteModalClose">&times;</button>
    </div>
    <div id="dateNoteContent">
      <div class="field">
        <label>Judul</label>
        <input type="text" id="dateNoteTitle" placeholder="Judul catatan untuk tanggal ini">
      </div>
      <div class="field">
        <label>Isi</label>
        <textarea id="dateNoteContentText" rows="5" placeholder="Tulis catatan Anda untuk tanggal ini..."></textarea>
      </div>
      <div class="field">
        <label>Warna</label>
        <select id="dateNoteColor">
          <option value="">Default</option>
          <option value="red">Merah</option>
          <option value="blue">Biru</option>
          <option value="green">Hijau</option>
          <option value="yellow">Kuning</option>
          <option value="purple">Ungu</option>
        </select>
      </div>
      <div class="controls">
        <button class="btn" id="saveDateNoteBtn">Simpan Catatan</button>
        <button class="btn" id="deleteDateNoteBtn" style="display: none;">Hapus Catatan</button>
      </div>
    </div>
  </div>
</div>

<!-- Contact Modal -->
<div class="modal-overlay" id="contactModal">
  <div class="modal">
    <div class="modal-header">
      <h3>Hubungi Kami</h3>
      <button class="modal-close" id="contactModalClose">&times;</button>
    </div>
    <div class="contact-list">
      <div class="contact-item" data-type="email">
        <div class="contact-icon">
          <img src="https://www.gstatic.com/images/icons/material/system/2x/email_googblue_24dp.png" alt="Email">
        </div>
        <div class="contact-info">
          <div class="contact-label">Email</div>
          <div class="contact-value">rohmatulloh.3609@gmail.com</div>
        </div>
      </div>
      <div class="contact-item" data-type="whatsapp">
        <div class="contact-icon">
          <img src="https://cdn-icons-png.flaticon.com/512/124/124034.png" alt="WhatsApp" style="width: 24px; height: 24px;">
        </div>
        <div class="contact-info">
          <div class="contact-label">WhatsApp</div>
          <div class="contact-value">+62 85931109567</div>
        </div>
      </div>
      <div class="contact-item" data-type="telegram">
        <div class="contact-icon">
          <img src="https://cdn-icons-png.flaticon.com/512/2111/2111646.png" alt="Telegram" style="width: 24px; height: 24px;">
        </div>
        <div class="contact-info">
          <div class="contact-label">Telegram</div>
          <div class="contact-value">@username</div>
        </div>
      </div>
      <div class="contact-item" data-type="instagram">
        <div class="contact-icon">
          <img src="https://cdn-icons-png.flaticon.com/512/174/174855.png" alt="Instagram" style="width: 24px; height: 24px;">
        </div>
        <div class="contact-info">
          <div class="contact-label">Instagram</div>
          <div class="contact-value">@rahmt_nhw</div>
        </div>
      </div>
      <div class="contact-item" data-type="github">
        <div class="contact-icon">
          <img src="https://cdn-icons-png.flaticon.com/512/25/25231.png" alt="GitHub" style="width: 24px; height: 24px;">
        </div>
        <div class="contact-info">
          <div class="contact-label">GitHub</div>
          <div class="contact-value">github.com/username</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Aplikasi TugasKu PRO v5.9.2 - JavaScript Utama
  document.addEventListener('DOMContentLoaded', function() {
    // Inisialisasi variabel global
    let tasks = [];
    let schedules = [];
    let notes = [];
    let dateNotes = []; // Catatan untuk tanggal tertentu
    let currentFilter = 'all';
    let currentEditTaskId = null;
    let currentEditNoteId = null;
    let currentEditScheduleId = null;
    let timerInterval = null;
    let timerSeconds = 25 * 60; // Default 25 menit
    let timerMode = 'focus'; // focus, short, long
    let isTimerRunning = false;
    let currentMonth = new Date();
    let selectedDate = null;
    let homeTaskChart = null;
    let taskChart = null;
    let priorityChart = null;
    let productivityChart = null;
    let dashboardActivityChart = null;
    
    // Konstanta timer
    let FOCUS_TIME = 25 * 60; // 25 menit
    let SHORT_BREAK_TIME = 5 * 60; // 5 menit
    let LONG_BREAK_TIME = 15 * 60; // 15 menit
    
    // Data untuk statistik
    let productivityData = {
      todayPomodoros: 0,
      weekPomodoros: 0,
      totalPomodoros: 0,
      focusTime: 0, // dalam menit
      pomodoroHistory: []
    };
    
    // Data untuk pencapaian
    let achievements = [];
    
    // Data untuk notifikasi
    let notifications = [];
    
    // Data untuk profil pengguna
    let userProfile = {
      name: 'Pengguna TugasKu',
      bio: 'Pelajar Aktif',
      title: 'Pelajar',
      avatar: null,
      avatarType: 'emoji',
      avatarEmoji: ''
    };
    
    // Data untuk pengaturan
    let appSettings = {
      theme: 'midnight-tech',
      notificationsEnabled: true,
      notificationLeadDays: 2,
      useBrowserNotification: false,
      autoSaveEnabled: true,
      quickActionsEnabled: true,
      darkReaderEnabled: false,
      liteMode: false,
      timerSettings: {
        focusDuration: 25,
        shortBreakDuration: 5,
        longBreakDuration: 15
      }
    };
    
    // Data untuk dashboard
    let dashboardData = {
      totalTasks: 0,
      completedTasks: 0,
      focusTime: 0,
      productivity: 0
    };
    
    // PWA Install Prompt
    let deferredPrompt;
    const installButton = document.createElement('button');
    installButton.className = 'install-promotion';
    
    // Simulasi loading
    setTimeout(() => {
      document.getElementById('splash').style.display = 'none';
      document.getElementById('mainContent').style.display = 'block';
      
      // Inisialisasi setelah loading selesai
      initApp();
    }, 2000);
    
    // Fungsi utama untuk inisialisasi aplikasi
    function initApp() {
      // Muat data dari localStorage
      loadData();
      
      // Setup event listeners
      setupEventListeners();
      
      // Render data awal
      renderTasks();
      renderSchedules();
      renderNotes();
      renderCalendar();
      updateDashboard();
      updateStats();
      updateProductivityStats();
      
      // Setup tab navigation
      setupTabNavigation();
      
      // Setup drag and drop untuk tugas
      setupDragAndDrop();
      
      // Setup timer
      updateTimerDisplay();
      
      // Setup profil
      updateProfileUI();
      
      // Setup pengaturan
      updateSettingsUI();
      
      // Setup pencapaian
      updateAchievements();
      
      // Setup notifikasi
      updateNotifications();
      
      // Setup charts
      initCharts();
      
      // Setup mode ringan
      updateLiteMode();
      
      // Cek notifikasi deadline
      checkDeadlineNotifications();
      
      // Tampilkan notifikasi update
      showUpdateNotification();
      
      // Tampilkan toast selamat datang
      showToast('Selamat datang di TugasKu PRO v5.9.2! Perbaikan bug tema dan notifikasi!', 3000);
      
      // Setup PWA
      setupPWA();
    }
    
    // Setup PWA functionality
    function setupPWA() {
      // Service Worker Registration dengan error handling yang lebih baik
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', function() {
          // Gunakan path relatif untuk service worker
          navigator.serviceWorker.register('./sw.js')
            .then(function(registration) {
              console.log('ServiceWorker registration successful with scope: ', registration.scope);
              
              // Check for updates
              registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                console.log('Service Worker update found!', newWorker);
                
                newWorker.addEventListener('statechange', () => {
                  if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                    showToast('Update tersedia! Refresh untuk mendapatkan versi terbaru.', 5000);
                  }
                });
              });
            })
            .catch(function(error) {
              console.log('ServiceWorker registration failed: ', error);
              // Fallback: tetap jalankan aplikasi tanpa service worker
              console.log('Aplikasi berjalan tanpa service worker');
            });
        });

        // Listen for claiming of service worker
        let refreshing = false;
        navigator.serviceWorker.addEventListener('controllerchange', () => {
          if (!refreshing) {
            window.location.reload();
            refreshing = true;
          }
        });
      }

      // PWA Install Prompt dengan improvements
      window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        
        // Tampilkan notifikasi bahwa aplikasi dapat diinstall
        showToast('Aplikasi dapat diinstall ke layar utama!', 5000);
        
        // Tampilkan tombol install setelah 5 detik
        setTimeout(() => {
          showInstallPromotion();
        }, 5000);
      });

      // Network status detection
      window.addEventListener('online', function() {
        showToast('Koneksi internet tersedia', 2000);
      });

      window.addEventListener('offline', function() {
        showToast('Anda sedang offline. Beberapa fitur mungkin terbatas.', 3000);
      });
      
      // Check if app is running as PWA
      if (window.matchMedia('(display-mode: standalone)').matches || 
          window.navigator.standalone === true) {
        console.log('App running as PWA');
        document.body.classList.add('pwa-mode');
      }
    }
    
    function showInstallPromotion() {
      if (!deferredPrompt) return;
      
      console.log('App can be installed');
      
      // Create install button
      installButton.innerHTML = ' Install TugasKu PRO';
      installButton.addEventListener('click', installApp);
      
      // Add hover effects
      installButton.addEventListener('mouseenter', function() {
        this.style.transform = 'translateY(-2px)';
        this.style.boxShadow = '0 12px 30px rgba(0,0,0,0.4)';
      });
      
      installButton.addEventListener('mouseleave', function() {
        this.style.transform = 'translateY(0)';
        this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.3)';
      });
      
      document.body.appendChild(installButton);
      
      // Auto hide setelah 15 detik
      setTimeout(() => {
        if (installButton.parentNode) {
          installButton.style.opacity = '0';
          installButton.style.transform = 'translateY(20px)';
          setTimeout(() => {
            if (installButton.parentNode) {
              installButton.remove();
            }
          }, 300);
        }
      }, 15000);
    }

    function installApp() {
      if (deferredPrompt) {
        deferredPrompt.prompt();
        
        deferredPrompt.userChoice.then((choiceResult) => {
          if (choiceResult.outcome === 'accepted') {
            console.log('User accepted the install prompt');
            showToast('Aplikasi berhasil diinstall!', 3000);
            
            // Update UI atau track installation
            if (installButton.parentNode) {
              installButton.remove();
            }
          } else {
            console.log('User dismissed the install prompt');
            showToast('Anda dapat install nanti melalui menu browser', 3000);
          }
          deferredPrompt = null;
        });
      } else {
        showToast('Fitur install tidak tersedia di browser ini', 3000);
      }
    }
    
    // Tampilkan notifikasi update
    function showUpdateNotification() {
      const lastVersion = localStorage.getItem('lastVersion');
      if (!lastVersion || lastVersion !== '5.9.2') {
        addNotification(
          ' Update Tersedia! v5.9.2', 
          'TugasKu PRO telah diperbarui! Perbaikan bug tema, notifikasi deadline yang lebih akurat, dan telah tersedia kontak developer!', 
          'info'
        );
        localStorage.setItem('lastVersion', '5.9.2');
      }
    }
    
    // Cek notifikasi deadline - DIPERBARUI
    function checkDeadlineNotifications() {
      if (!appSettings.notificationsEnabled) return;
      
      const now = new Date();
      const leadDays = appSettings.notificationLeadDays;
      const leadTime = leadDays * 24 * 60 * 60 * 1000; // dalam milidetik
      
      tasks.forEach(task => {
        if (task.completed) return;
        
        if (task.deadline) {
          const deadline = new Date(task.deadline);
          const timeUntilDeadline = deadline - now;
          
          // Jika deadline sudah lewat
          if (timeUntilDeadline < 0) {
            const notificationId = `deadline-overdue-${task.id}`;
            
            // Cek apakah notifikasi sudah ada
            const existingNotification = notifications.find(n => n.id === notificationId);
            if (!existingNotification) {
              addNotification(
                'Tugas Terlambat',
                `Tugas "${task.title}" sudah melewati deadline`,
                'error',
                notificationId
              );
            }
          }
          // Jika deadline dalam jangka waktu notifikasi
          else if (timeUntilDeadline > 0 && timeUntilDeadline <= leadTime) {
            const daysUntilDeadline = Math.ceil(timeUntilDeadline / (1000 * 60 * 60 * 24));
            const notificationId = `deadline-${task.id}`;
            
            // Cek apakah notifikasi sudah ada
            const existingNotification = notifications.find(n => n.id === notificationId);
            if (!existingNotification) {
              addNotification(
                'Deadline Mendekati',
                `Tugas "${task.title}" deadline dalam ${daysUntilDeadline} hari`,
                'warning',
                notificationId
              );
            }
          }
        }
      });
    }
    
    // Muat data dari localStorage - DIPERBARUI untuk tema
    function loadData() {
      // Muat tema terlebih dahulu untuk mencegah flash tema default
      const savedSettings = localStorage.getItem('tugasKu_settings');
      if (savedSettings) {
        appSettings = JSON.parse(savedSettings);
      }
      
      // Terapkan tema sebelum konten dimuat
      applyTheme(appSettings.theme);
      
      // Muat tugas
      const savedTasks = localStorage.getItem('tugasKu_tasks');
      if (savedTasks) {
        tasks = JSON.parse(savedTasks);
      }
      
      // Muat jadwal
      const savedSchedules = localStorage.getItem('tugasKu_schedules');
      if (savedSchedules) {
        schedules = JSON.parse(savedSchedules);
      }
      
      // Muat catatan
      const savedNotes = localStorage.getItem('tugasKu_notes');
      if (savedNotes) {
        notes = JSON.parse(savedNotes);
      }
      
      // Muat catatan tanggal
      const savedDateNotes = localStorage.getItem('tugasKu_dateNotes');
      if (savedDateNotes) {
        dateNotes = JSON.parse(savedDateNotes);
      }
      
      // Muat profil
      const savedProfile = localStorage.getItem('tugasKu_profile');
      if (savedProfile) {
        userProfile = JSON.parse(savedProfile);
      }
      
      // Muat data produktivitas
      const savedProductivity = localStorage.getItem('tugasKu_productivity');
      if (savedProductivity) {
        productivityData = JSON.parse(savedProductivity);
      }
      
      // Muat pencapaian
      const savedAchievements = localStorage.getItem('tugasKu_achievements');
      if (savedAchievements) {
        achievements = JSON.parse(savedAchievements);
      }
      
      // Muat notifikasi
      const savedNotifications = localStorage.getItem('tugasKu_notifications');
      if (savedNotifications) {
        notifications = JSON.parse(savedNotifications);
      }
      
      // Muat data dashboard
      const savedDashboard = localStorage.getItem('tugasKu_dashboard');
      if (savedDashboard) {
        dashboardData = JSON.parse(savedDashboard);
      }
      
      // Muat pengaturan timer
      const savedTimerSettings = localStorage.getItem('tugasKu_timerSettings');
      if (savedTimerSettings) {
        appSettings.timerSettings = JSON.parse(savedTimerSettings);
      }
      
      // Update timer berdasarkan pengaturan
      FOCUS_TIME = appSettings.timerSettings.focusDuration * 60;
      SHORT_BREAK_TIME = appSettings.timerSettings.shortBreakDuration * 60;
      LONG_BREAK_TIME = appSettings.timerSettings.longBreakDuration * 60;
      
      // Set timer ke mode fokus
      timerSeconds = FOCUS_TIME;
      updateTimerDisplay();
    }
    
    // Simpan data ke localStorage
    function saveData() {
      localStorage.setItem('tugasKu_tasks', JSON.stringify(tasks));
      localStorage.setItem('tugasKu_schedules', JSON.stringify(schedules));
      localStorage.setItem('tugasKu_notes', JSON.stringify(notes));
      localStorage.setItem('tugasKu_dateNotes', JSON.stringify(dateNotes));
      localStorage.setItem('tugasKu_profile', JSON.stringify(userProfile));
      localStorage.setItem('tugasKu_settings', JSON.stringify(appSettings));
      localStorage.setItem('tugasKu_productivity', JSON.stringify(productivityData));
      localStorage.setItem('tugasKu_achievements', JSON.stringify(achievements));
      localStorage.setItem('tugasKu_notifications', JSON.stringify(notifications));
      localStorage.setItem('tugasKu_dashboard', JSON.stringify(dashboardData));
      localStorage.setItem('tugasKu_timerSettings', JSON.stringify(appSettings.timerSettings));
    }
    
    // Fungsi untuk menerapkan tema - DIPERBARUI
    function applyTheme(theme) {
      // Hapus semua kelas tema
      document.body.classList.remove(
        'light-mode', 'dark-pro-mode', 'dark-pro-shift-mode', 'midnight-tech-mode',
        'carbon-blue-mode', 'cyber-gray-mode', 'blue-mist-mode', 'pink-elegant-mode',
        'pro-gold-mode', 'pro-forest-mode', 'neon-dark-mode', 'sunset-vibes-mode'
      );
      
      // Tambah kelas tema baru
      if (theme !== 'dark') {
        document.body.classList.add(theme + '-mode');
      }
      
      // Simpan pengaturan tema
      appSettings.theme = theme;
      saveData();
    }
    
    // Setup event listeners
    function setupEventListeners() {
      // Tab navigation
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const tabId = this.getAttribute('data-tab');
          switchTab(tabId);
        });
      });
      
      // Filter tugas
      document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          currentFilter = this.getAttribute('data-filter');
          document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
          this.classList.add('active');
          renderTasks();
        });
      });
      
      // Search tugas
      document.getElementById('taskSearch').addEventListener('input', function() {
        renderTasks();
      });
      
      // Menu drawer
      document.getElementById('menuBtn').addEventListener('click', openMenu);
      document.getElementById('menuClose').addEventListener('click', closeMenu);
      
      // Menu items
      document.querySelectorAll('.menu-item').forEach(item => {
        item.addEventListener('click', function() {
          const action = this.getAttribute('data-action');
          handleMenuItemClick(action);
        });
      });
      
      // Profile section
      document.getElementById('profileSection').addEventListener('click', function() {
        openProfileModal();
      });
      
      // FAB untuk tambah tugas
      document.getElementById('addTaskBtn').addEventListener('click', function() {
        openTaskModal();
      });
      
      // Task modal
      document.getElementById('taskModalClose').addEventListener('click', closeTaskModal);
      document.getElementById('cancelTaskBtn').addEventListener('click', closeTaskModal);
      document.getElementById('taskForm').addEventListener('submit', saveTask);
      
      // Stats modal
      document.getElementById('statsBtn').addEventListener('click', openStatsModal);
      document.getElementById('statsModalClose').addEventListener('click', closeStatsModal);
      
      // Theme modal - DIPERBARUI
      document.getElementById('themeModalClose').addEventListener('click', closeThemeModal);
      document.querySelectorAll('.theme-option').forEach(option => {
        option.addEventListener('click', function() {
          const theme = this.getAttribute('data-theme');
          changeTheme(theme);
        });
      });
      
      // Profile modal
      document.getElementById('profileModalClose').addEventListener('click', closeProfileModal);
      document.getElementById('editProfileBtn').addEventListener('click', openEditProfileModal);
      document.getElementById('deleteProfileBtn').addEventListener('click', confirmDeleteProfile);
      document.getElementById('changeAvatarBtn').addEventListener('click', triggerAvatarUpload);
      
      // Edit Profile modal
      document.getElementById('editProfileModalClose').addEventListener('click', closeEditProfileModal);
      document.getElementById('cancelEditProfileBtn').addEventListener('click', closeEditProfileModal);
      document.getElementById('saveEditProfileBtn').addEventListener('click', saveEditProfile);
      
      // Avatar modal
      document.getElementById('avatarModalClose').addEventListener('click', closeAvatarModal);
      document.getElementById('cancelAvatarBtn').addEventListener('click', closeAvatarModal);
      document.getElementById('saveAvatarBtn').addEventListener('click', saveAvatar);
      document.getElementById('uploadArea').addEventListener('click', triggerAvatarUpload);
      document.getElementById('avatarInput').addEventListener('change', handleAvatarUpload);
      
      // Delete modal
      document.getElementById('deleteModalClose').addEventListener('click', closeDeleteModal);
      document.getElementById('cancelDeleteBtn').addEventListener('click', closeDeleteModal);
      document.getElementById('confirmDeleteBtn').addEventListener('click', deleteAvatar);
      
      // Settings modal
      document.getElementById('settingsModalClose').addEventListener('click', closeSettingsModal);
      document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);
      
      // Tips modal
      document.getElementById('tipsModalClose').addEventListener('click', closeTipsModal);
      
      // About modal
      document.getElementById('aboutModalClose').addEventListener('click', closeAboutModal);
      
      // Notifications modal
      document.getElementById('notifBtn').addEventListener('click', openNotificationsModal);
      document.getElementById('notificationsModalClose').addEventListener('click', closeNotificationsModal);
      
      // Timer controls
      document.getElementById('startTimer').addEventListener('click', startTimer);
      document.getElementById('pauseTimer').addEventListener('click', pauseTimer);
      document.getElementById('resetTimer').addEventListener('click', resetTimer);
      
      // Timer mode
      document.querySelectorAll('.timer-mode-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const mode = this.getAttribute('data-mode');
          switchTimerMode(mode);
        });
      });
      
      // Timer settings
      document.getElementById('saveTimerSettings').addEventListener('click', saveTimerSettings);
      
      // Schedule
      document.getElementById('addScheduleBtn').addEventListener('click', addSchedule);
      
      // Notes
      document.getElementById('addNoteBtn').addEventListener('click', addNote);
      
      // Calendar
      document.getElementById('prevMonth').addEventListener('click', prevMonth);
      document.getElementById('nextMonth').addEventListener('click', nextMonth);
      
      // Date note modal
      document.getElementById('dateNoteModalClose').addEventListener('click', closeDateNoteModal);
      document.getElementById('saveDateNoteBtn').addEventListener('click', saveDateNote);
      document.getElementById('deleteDateNoteBtn').addEventListener('click', deleteDateNote);
      
      // Contact modal
      document.getElementById('contactModalClose').addEventListener('click', closeContactModal);
      document.querySelectorAll('.contact-item').forEach(item => {
        item.addEventListener('click', function() {
          const type = this.getAttribute('data-type');
          handleContactClick(type);
        });
      });
      
      // Setup event untuk klik di luar modal
      document.querySelectorAll('.modal-overlay').forEach(overlay => {
        overlay.addEventListener('click', function(e) {
          if (e.target === this) {
            this.classList.remove('show');
          }
        });
      });
      
      // Setup event untuk double click pada kalender
      document.getElementById('calendarGrid').addEventListener('dblclick', function(e) {
        const dayElement = e.target.closest('.calendar-day');
        if (dayElement && !dayElement.classList.contains('empty')) {
          const day = parseInt(dayElement.textContent);
          const year = currentMonth.getFullYear();
          const month = currentMonth.getMonth();
          const date = new Date(year, month, day);
          
          // Buka modal untuk menambah/melihat catatan tanggal
          openDateNoteModal(date);
        }
      });
      
      // Setup event untuk klik pada kalender (untuk melihat tugas)
      document.getElementById('calendarGrid').addEventListener('click', function(e) {
        const dayElement = e.target.closest('.calendar-day');
        if (dayElement && !dayElement.classList.contains('empty')) {
          const day = parseInt(dayElement.textContent);
          const year = currentMonth.getFullYear();
          const month = currentMonth.getMonth();
          const date = new Date(year, month, day);
          
          // Set selectedDate dan update tampilan
          selectedDate = date;
          updateSelectedDateTasks();
        }
      });
      
      // Event listener untuk header saat di-scroll
      window.addEventListener('scroll', function() {
        const header = document.querySelector('header');
        if (window.scrollY > 50) {
          header.classList.add('header-scrolling');
        } else {
          header.classList.remove('header-scrolling');
        }
      });
    }
    
    // Setup tab navigation
    function setupTabNavigation() {
      // Aktifkan tab dashboard secara default
      switchTab('dashboard');
    }
    
    // Switch tab
    function switchTab(tabId) {
      // Update tab buttons
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
      
      // Update tab content
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(`${tabId}Tab`).classList.add('active');
      
      // Update konten berdasarkan tab
      if (tabId === 'dashboard') {
        updateDashboard();
      } else if (tabId === 'tasks') {
        renderTasks();
        updateHomeStats();
      } else if (tabId === 'schedule') {
        renderSchedules();
      } else if (tabId === 'notes') {
        renderNotes();
      } else if (tabId === 'calendar') {
        renderCalendar();
      } else if (tabId === 'productivity') {
        updateProductivityStats();
      }
    }
    
    // Setup drag and drop untuk tugas
    function setupDragAndDrop() {
      const tasksList = document.getElementById('tasksList');
      
      tasksList.addEventListener('dragstart', function(e) {
        if (e.target.classList.contains('task-card')) {
          e.target.classList.add('dragging');
          e.dataTransfer.setData('text/plain', e.target.id);
        }
      });
      
      tasksList.addEventListener('dragend', function(e) {
        if (e.target.classList.contains('task-card')) {
          e.target.classList.remove('dragging');
        }
      });
      
      tasksList.addEventListener('dragover', function(e) {
        e.preventDefault();
        const afterElement = getDragAfterElement(tasksList, e.clientY);
        const draggable = document.querySelector('.dragging');
        if (draggable) {
          if (afterElement == null) {
            tasksList.appendChild(draggable);
          } else {
            tasksList.insertBefore(draggable, afterElement);
          }
        }
      });
      
      // Update urutan tugas setelah drag selesai
      tasksList.addEventListener('drop', function(e) {
        e.preventDefault();
        const taskId = e.dataTransfer.getData('text/plain');
        const taskElement = document.getElementById(taskId);
        if (taskElement) {
          // Dapatkan urutan baru dari DOM
          const taskElements = Array.from(tasksList.querySelectorAll('.task-card'));
          const newOrder = taskElements.map(el => el.id.replace('task-', ''));
          
          // Update urutan dalam array tasks
          const orderedTasks = [];
          newOrder.forEach(id => {
            const task = tasks.find(t => t.id === id);
            if (task) orderedTasks.push(task);
          });
          
          tasks = orderedTasks;
          saveData();
        }
      });
    }
    
    // Helper untuk drag and drop
    function getDragAfterElement(container, y) {
      const draggableElements = [...container.querySelectorAll('.task-card:not(.dragging)')];
      
      return draggableElements.reduce((closest, child) => {
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height / 2;
        if (offset < 0 && offset > closest.offset) {
          return { offset: offset, element: child };
        } else {
          return closest;
        }
      }, { offset: Number.NEGATIVE_INFINITY }).element;
    }
    
    // Render tugas
    function renderTasks() {
      const tasksList = document.getElementById('tasksList');
      const searchTerm = document.getElementById('taskSearch').value.toLowerCase();
      
      // Filter tugas berdasarkan pencarian dan filter
      let filteredTasks = tasks.filter(task => {
        const matchesSearch = task.title.toLowerCase().includes(searchTerm) || 
                             (task.description && task.description.toLowerCase().includes(searchTerm));
        
        if (!matchesSearch) return false;
        
        if (currentFilter === 'all') return true;
        if (currentFilter === 'pending') return !task.completed;
        if (currentFilter === 'completed') return task.completed;
        if (currentFilter === 'overdue') return isTaskOverdue(task) && !task.completed;
        if (currentFilter === 'high') return task.priority === 'high';
        if (currentFilter === 'today') return isTaskDueToday(task);
        
        return true;
      });
      
      if (filteredTasks.length === 0) {
        tasksList.innerHTML = `
          <div class="empty-state">
            <h3>Tidak ada tugas</h3>
            <p>Tidak ada tugas yang sesuai dengan filter Anda</p>
          </div>
        `;
        return;
      }
      
      tasksList.innerHTML = '';
      
      filteredTasks.forEach(task => {
        const taskElement = createTaskElement(task);
        tasksList.appendChild(taskElement);
      });
    }
    
    // Buat elemen tugas
    function createTaskElement(task) {
      const taskElement = document.createElement('div');
      taskElement.className = `task-card priority-${task.priority}`;
      taskElement.id = `task-${task.id}`;
      taskElement.draggable = true;
      
      // Tentukan status deadline
      let deadlineStatus = '';
      let deadlineText = '';
      
      if (task.completed) {
        deadlineStatus = 'dl-ok';
        deadlineText = 'Selesai';
      } else if (isTaskOverdue(task)) {
        deadlineStatus = 'dl-overdue';
        deadlineText = 'Terlambat';
      } else if (isTaskDueToday(task)) {
        deadlineStatus = 'dl-urgent';
        deadlineText = 'Hari Ini';
      } else if (isTaskDueSoon(task)) {
        deadlineStatus = 'dl-soon';
        deadlineText = 'Segera';
      } else {
        deadlineStatus = 'dl-ok';
        deadlineText = 'Aktif';
      }
      
      // Tentukan kelas indikator prioritas
      let priorityIndicatorClass = '';
      if (task.priority === 'high') {
        priorityIndicatorClass = 'priority-high-indicator';
      } else if (task.priority === 'medium') {
        priorityIndicatorClass = 'priority-medium-indicator';
      } else {
        priorityIndicatorClass = 'priority-low-indicator';
      }
      
      taskElement.innerHTML = `
        <div class="task-title">
          <span class="priority-indicator ${priorityIndicatorClass}"></span>
          <span class="title-text">${escapeHtml(task.title)}</span>
          <div class="status-pill ${deadlineStatus}">${deadlineText}</div>
        </div>
        ${task.description ? `<div class="task-detail">${escapeHtml(task.description)}</div>` : ''}
        <div class="task-detail">
          <span> ${formatDate(task.deadline)}</span>
          <span> ${task.category || 'Umum'}</span>
        </div>
        <div class="task-actions">
          <button class="icon-btn" onclick="toggleTaskCompletion('${task.id}')" title="${task.completed ? 'Tandai belum selesai' : 'Tandai selesai'}">
            ${task.completed ? '' : ''}
          </button>
          <button class="icon-btn" onclick="editTask('${task.id}')" title="Edit tugas"></button>
          <button class="icon-btn" onclick="deleteTask('${task.id}')" title="Hapus tugas"></button>
        </div>
      `;
      
      return taskElement;
    }
    
    // Toggle status penyelesaian tugas
    function toggleTaskCompletion(taskId) {
      const taskIndex = tasks.findIndex(task => task.id === taskId);
      if (taskIndex !== -1) {
        tasks[taskIndex].completed = !tasks[taskIndex].completed;
        saveData();
        renderTasks();
        updateStats();
        updateHomeStats();
        updateDashboard();
        
        // Tambah notifikasi
        if (tasks[taskIndex].completed) {
          addNotification('Tugas Selesai', `Tugas "${tasks[taskIndex].title}" telah diselesaikan`, 'success');
        }
      }
    }
    
    // Edit tugas
    function editTask(taskId) {
      const task = tasks.find(task => task.id === taskId);
      if (task) {
        currentEditTaskId = taskId;
        document.getElementById('taskModalTitle').textContent = 'Edit Tugas';
        document.getElementById('taskTitle').value = task.title;
        document.getElementById('taskDesc').value = task.description || '';
        document.getElementById('taskDeadline').value = task.deadline;
        document.getElementById('taskPriority').value = task.priority;
        document.getElementById('taskCategory').value = task.category || '';
        openTaskModal();
      }
    }
    
    // Hapus tugas
    function deleteTask(taskId) {
      if (confirm('Apakah Anda yakin ingin menghapus tugas ini?')) {
        tasks = tasks.filter(task => task.id !== taskId);
        saveData();
        renderTasks();
        updateStats();
        updateHomeStats();
        updateDashboard();
        showToast('Tugas berhasil dihapus');
      }
    }
    
    // Buka modal tugas
    function openTaskModal() {
      document.getElementById('taskModal').classList.add('show');
    }
    
    // Tutup modal tugas
    function closeTaskModal() {
      document.getElementById('taskModal').classList.remove('show');
      document.getElementById('taskForm').reset();
      currentEditTaskId = null;
      document.getElementById('taskModalTitle').textContent = 'Tambah Tugas Baru';
    }
    
    // Simpan tugas
    function saveTask(e) {
      e.preventDefault();
      
      const title = document.getElementById('taskTitle').value.trim();
      const description = document.getElementById('taskDesc').value.trim();
      const deadline = document.getElementById('taskDeadline').value;
      const priority = document.getElementById('taskPriority').value;
      const category = document.getElementById('taskCategory').value.trim();
      
      if (!title) {
        alert('Judul tugas harus diisi');
        return;
      }
      
      if (currentEditTaskId) {
        // Edit tugas yang sudah ada
        const taskIndex = tasks.findIndex(task => task.id === currentEditTaskId);
        if (taskIndex !== -1) {
          tasks[taskIndex].title = title;
          tasks[taskIndex].description = description;
          tasks[taskIndex].deadline = deadline;
          tasks[taskIndex].priority = priority;
          tasks[taskIndex].category = category;
          tasks[taskIndex].updatedAt = new Date().toISOString();
        }
      } else {
        // Tambah tugas baru
        const newTask = {
          id: generateId(),
          title,
          description,
          deadline,
          priority,
          category: category || 'Umum',
          completed: false,
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString()
        };
        
        tasks.unshift(newTask);
      }
      
      saveData();
      renderTasks();
      updateStats();
      updateHomeStats();
      updateDashboard();
      closeTaskModal();
      
      showToast(currentEditTaskId ? 'Tugas berhasil diperbarui' : 'Tugas berhasil ditambahkan');
      
      // Reset edit ID
      currentEditTaskId = null;
      
      // Cek notifikasi deadline
      checkDeadlineNotifications();
    }
    
    // Render jadwal
    function renderSchedules() {
      const scheduleList = document.getElementById('scheduleList');
      
      if (schedules.length === 0) {
        scheduleList.innerHTML = `
          <div class="empty-state">
            <h3>Belum ada jadwal</h3>
            <p>Tambahkan jadwal mingguan Anda</p>
          </div>
        `;
        return;
      }
      
      // Kelompokkan jadwal berdasarkan hari
      const scheduleByDay = {
        senin: [],
        selasa: [],
        rabu: [],
        kamis: [],
        jumat: [],
        sabtu: [],
        minggu: []
      };
      
      schedules.forEach(schedule => {
        if (scheduleByDay[schedule.day]) {
          scheduleByDay[schedule.day].push(schedule);
        }
      });
      
      // Urutkan jadwal berdasarkan waktu
      Object.keys(scheduleByDay).forEach(day => {
        scheduleByDay[day].sort((a, b) => a.time.localeCompare(b.time));
      });
      
      scheduleList.innerHTML = '';
      
      // Render jadwal per hari
      Object.keys(scheduleByDay).forEach(day => {
        if (scheduleByDay[day].length > 0) {
          const dayElement = document.createElement('div');
          dayElement.className = 'schedule-day';
          
          const dayName = getDayName(day);
          
          dayElement.innerHTML = `
            <div class="schedule-header">${dayName}</div>
          `;
          
          scheduleByDay[day].forEach(schedule => {
            const scheduleElement = document.createElement('div');
            scheduleElement.className = 'schedule-item';
            scheduleElement.innerHTML = `
              <div class="schedule-time">${schedule.time}</div>
              <div class="schedule-subject">${escapeHtml(schedule.subject)}</div>
              <div class="schedule-desc">${escapeHtml(schedule.description || '')}</div>
              <div class="schedule-actions">
                <button class="icon-btn" onclick="editSchedule('${schedule.id}')" title="Edit jadwal"></button>
                <button class="icon-btn" onclick="deleteSchedule('${schedule.id}')" title="Hapus jadwal"></button>
              </div>
            `;
            
            dayElement.appendChild(scheduleElement);
          });
          
          scheduleList.appendChild(dayElement);
        }
      });
    }
    
    // Tambah jadwal
    function addSchedule() {
      const day = document.getElementById('scheduleDay').value;
      const time = document.getElementById('scheduleTime').value;
      const subject = document.getElementById('scheduleSubject').value.trim();
      const description = document.getElementById('scheduleDesc').value.trim();
      
      if (!time || !subject) {
        alert('Waktu dan mata pelajaran/kegiatan harus diisi');
        return;
      }
      
      const newSchedule = {
        id: generateId(),
        day,
        time,
        subject,
        description,
        createdAt: new Date().toISOString()
      };
      
      schedules.push(newSchedule);
      saveData();
      renderSchedules();
      
      // Reset form
      document.getElementById('scheduleSubject').value = '';
      document.getElementById('scheduleDesc').value = '';
      
      showToast('Jadwal berhasil ditambahkan');
    }
    
    // Edit jadwal
    function editSchedule(scheduleId) {
      const schedule = schedules.find(s => s.id === scheduleId);
      if (schedule) {
        currentEditScheduleId = scheduleId;
        document.getElementById('scheduleDay').value = schedule.day;
        document.getElementById('scheduleTime').value = schedule.time;
        document.getElementById('scheduleSubject').value = schedule.subject;
        document.getElementById('scheduleDesc').value = schedule.description || '';
        
        // Hapus jadwal lama
        schedules = schedules.filter(s => s.id !== scheduleId);
        renderSchedules();
      }
    }
    
    // Hapus jadwal
    function deleteSchedule(scheduleId) {
      if (confirm('Apakah Anda yakin ingin menghapus jadwal ini?')) {
        schedules = schedules.filter(s => s.id !== scheduleId);
        saveData();
        renderSchedules();
        showToast('Jadwal berhasil dihapus');
      }
    }
    
    // Render catatan
    function renderNotes() {
      const notesList = document.getElementById('notesList');
      
      if (notes.length === 0) {
        notesList.innerHTML = `
          <div class="empty-state">
            <h3>Belum ada catatan</h3>
            <p>Tambahkan catatan pertama Anda</p>
          </div>
        `;
        return;
      }
      
      // Urutkan catatan: pinned di atas, lalu berdasarkan tanggal pembuatan terbaru
      const sortedNotes = [...notes].sort((a, b) => {
        if (a.pinned && !b.pinned) return -1;
        if (!a.pinned && b.pinned) return 1;
        return new Date(b.createdAt) - new Date(a.createdAt);
      });
      
      notesList.innerHTML = '';
      
      sortedNotes.forEach(note => {
        const noteElement = document.createElement('div');
        noteElement.className = `note-card ${note.color ? `note-${note.color}` : ''}`;
        
        noteElement.innerHTML = `
          ${note.pinned ? '<div class="status-pill" style="background: var(--warning);"> Disematkan</div>' : ''}
          <div class="note-title">${escapeHtml(note.title)}</div>
          <div class="note-content">${escapeHtml(note.content)}</div>
          <div class="note-meta">Dibuat: ${formatDateTime(note.createdAt)}</div>
          <div class="note-actions">
            <button class="icon-btn" onclick="toggleNotePin('${note.id}')" title="${note.pinned ? 'Lepas sematan' : 'Sematkan'}">
              ${note.pinned ? '' : ''}
            </button>
            <button class="icon-btn" onclick="editNote('${note.id}')" title="Edit catatan"></button>
            <button class="icon-btn" onclick="deleteNote('${note.id}')" title="Hapus catatan"></button>
          </div>
        `;
        
        notesList.appendChild(noteElement);
      });
    }
    
    // Tambah catatan
    function addNote() {
      const title = document.getElementById('noteTitle').value.trim();
      const content = document.getElementById('noteContent').value.trim();
      const color = document.getElementById('noteColor').value;
      const pinned = document.getElementById('notePinned').checked;
      
      if (!title || !content) {
        alert('Judul dan isi catatan harus diisi');
        return;
      }
      
      const newNote = {
        id: generateId(),
        title,
        content,
        color,
        pinned,
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
      };
      
      notes.push(newNote);
      saveData();
      renderNotes();
      
      // Reset form
      document.getElementById('noteTitle').value = '';
      document.getElementById('noteContent').value = '';
      document.getElementById('noteColor').value = '';
      document.getElementById('notePinned').checked = false;
      
      showToast('Catatan berhasil ditambahkan');
    }
    
    // Edit catatan
    function editNote(noteId) {
      const note = notes.find(n => n.id === noteId);
      if (note) {
        currentEditNoteId = noteId;
        document.getElementById('noteTitle').value = note.title;
        document.getElementById('noteContent').value = note.content;
        document.getElementById('noteColor').value = note.color || '';
        document.getElementById('notePinned').checked = note.pinned || false;
        
        // Hapus catatan lama
        notes = notes.filter(n => n.id !== noteId);
        renderNotes();
      }
    }
    
    // Hapus catatan
    function deleteNote(noteId) {
      if (confirm('Apakah Anda yakin ingin menghapus catatan ini?')) {
        notes = notes.filter(n => n.id !== noteId);
        saveData();
        renderNotes();
        showToast('Catatan berhasil dihapus');
      }
    }
    
    // Toggle pin catatan
    function toggleNotePin(noteId) {
      const noteIndex = notes.findIndex(n => n.id === noteId);
      if (noteIndex !== -1) {
        notes[noteIndex].pinned = !notes[noteIndex].pinned;
        saveData();
        renderNotes();
        showToast(notes[noteIndex].pinned ? 'Catatan disematkan' : 'Catatan dilepas');
      }
    }
    
    // Render kalender
    function renderCalendar() {
      const calendarGrid = document.getElementById('calendarGrid');
      const currentMonthElement = document.getElementById('currentMonth');
      
      // Update judul bulan
      const monthNames = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 
                         'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
      currentMonthElement.textContent = `${monthNames[currentMonth.getMonth()]} ${currentMonth.getFullYear()}`;
      
      // Kosongkan grid
      calendarGrid.innerHTML = '';
      
      // Tambah header hari
      const dayNames = ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab'];
      dayNames.forEach(day => {
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day-header';
        dayElement.textContent = day;
        calendarGrid.appendChild(dayElement);
      });
      
      // Dapatkan hari pertama bulan ini dan jumlah hari
      const firstDay = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), 1).getDay();
      const daysInMonth = new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1, 0).getDate();
      
      // Tambah hari kosong untuk hari pertama
      for (let i = 0; i < firstDay; i++) {
        const emptyDay = document.createElement('div');
        emptyDay.className = 'calendar-day empty';
        calendarGrid.appendChild(emptyDay);
      }
      
      // Tambah hari dalam bulan
      const today = new Date();
      for (let day = 1; day <= daysInMonth; day++) {
        const dayElement = document.createElement('div');
        dayElement.className = 'calendar-day';
        dayElement.textContent = day;
        
        // Periksa apakah hari ini
        const isToday = today.getDate() === day && 
                       today.getMonth() === currentMonth.getMonth() && 
                       today.getFullYear() === currentMonth.getFullYear();
        
        if (isToday) {
          dayElement.classList.add('today');
        }
        
        // Periksa apakah ada tugas pada tanggal ini
        const date = new Date(currentMonth.getFullYear(), currentMonth.getMonth(), day);
        const hasTask = tasks.some(task => {
          if (!task.deadline) return false;
          const taskDate = new Date(task.deadline);
          return taskDate.getDate() === date.getDate() && 
                 taskDate.getMonth() === date.getMonth() && 
                 taskDate.getFullYear() === date.getFullYear();
        });
        
        const hasOverdue = tasks.some(task => {
          if (!task.deadline || task.completed) return false;
          const taskDate = new Date(task.deadline);
          return taskDate < today && 
                 taskDate.getDate() === date.getDate() && 
                 taskDate.getMonth() === date.getMonth() && 
                 taskDate.getFullYear() === date.getFullYear();
        });
        
        if (hasOverdue) {
          dayElement.classList.add('has-overdue');
        } else if (hasTask) {
          dayElement.classList.add('has-task');
        }
        
        // Periksa apakah ada catatan tanggal
        const hasNote = dateNotes.some(note => {
          const noteDate = new Date(note.date);
          return noteDate.getDate() === date.getDate() && 
                 noteDate.getMonth() === date.getMonth() && 
                 noteDate.getFullYear() === date.getFullYear();
        });
        
        if (hasNote) {
          dayElement.classList.add('has-note');
        }
        
        calendarGrid.appendChild(dayElement);
      }
    }
    
    // Bulan sebelumnya
    function prevMonth() {
      currentMonth.setMonth(currentMonth.getMonth() - 1);
      renderCalendar();
    }
    
    // Bulan berikutnya
    function nextMonth() {
      currentMonth.setMonth(currentMonth.getMonth() + 1);
      renderCalendar();
    }
    
    // Update tugas untuk tanggal yang dipilih
    function updateSelectedDateTasks() {
      const selectedDateElement = document.getElementById('selectedDate');
      const selectedDateTasksElement = document.getElementById('selectedDateTasks');
      
      if (!selectedDate) {
        selectedDateElement.textContent = '-';
        selectedDateTasksElement.innerHTML = '<p>Pilih tanggal untuk melihat tugas</p>';
        return;
      }
      
      // Format tanggal
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      selectedDateElement.textContent = selectedDate.toLocaleDateString('id-ID', options);
      
      // Filter tugas untuk tanggal yang dipilih
      const dateTasks = tasks.filter(task => {
        if (!task.deadline) return false;
        const taskDate = new Date(task.deadline);
        return taskDate.getDate() === selectedDate.getDate() && 
               taskDate.getMonth() === selectedDate.getMonth() && 
               taskDate.getFullYear() === selectedDate.getFullYear();
      });
      
      if (dateTasks.length === 0) {
        selectedDateTasksElement.innerHTML = `
          <div class="empty-state">
            <p>Tidak ada tugas untuk tanggal ini</p>
          </div>
        `;
        return;
      }
      
      // Render tugas
      selectedDateTasksElement.innerHTML = '';
      dateTasks.forEach(task => {
        const taskElement = document.createElement('div');
        taskElement.className = `task-card priority-${task.priority}`;
        
        // Tentukan status deadline
        let deadlineStatus = '';
        let deadlineText = '';
        
        if (task.completed) {
          deadlineStatus = 'dl-ok';
          deadlineText = 'Selesai';
        } else if (isTaskOverdue(task)) {
          deadlineStatus = 'dl-overdue';
          deadlineText = 'Terlambat';
        } else if (isTaskDueToday(task)) {
          deadlineStatus = 'dl-urgent';
          deadlineText = 'Hari Ini';
        } else if (isTaskDueSoon(task)) {
          deadlineStatus = 'dl-soon';
          deadlineText = 'Segera';
        } else {
          deadlineStatus = 'dl-ok';
          deadlineText = 'Aktif';
        }
        
        // Tentukan kelas indikator prioritas
        let priorityIndicatorClass = '';
        if (task.priority === 'high') {
          priorityIndicatorClass = 'priority-high-indicator';
        } else if (task.priority === 'medium') {
          priorityIndicatorClass = 'priority-medium-indicator';
        } else {
          priorityIndicatorClass = 'priority-low-indicator';
        }
        
        taskElement.innerHTML = `
          <div class="task-title">
            <span class="priority-indicator ${priorityIndicatorClass}"></span>
            <span class="title-text">${escapeHtml(task.title)}</span>
            <div class="status-pill ${deadlineStatus}">${deadlineText}</div>
          </div>
          ${task.description ? `<div class="task-detail">${escapeHtml(task.description)}</div>` : ''}
          <div class="task-detail">
            <span> ${task.category || 'Umum'}</span>
            <span>${task.completed ? ' Selesai' : ' Belum selesai'}</span>
          </div>
          <div class="task-actions">
            <button class="icon-btn" onclick="toggleTaskCompletion('${task.id}')" title="${task.completed ? 'Tandai belum selesai' : 'Tandai selesai'}">
              ${task.completed ? '' : ''}
            </button>
            <button class="icon-btn" onclick="editTask('${task.id}')" title="Edit tugas"></button>
          </div>
        `;
        
        selectedDateTasksElement.appendChild(taskElement);
      });
    }
    
    // Buka modal catatan tanggal
    function openDateNoteModal(date) {
      selectedDate = date;
      
      // Format tanggal untuk judul
      const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
      const dateString = date.toLocaleDateString('id-ID', options);
      document.getElementById('dateNoteModalTitle').textContent = `Catatan untuk ${dateString}`;
      
      // Cek apakah sudah ada catatan untuk tanggal ini
      const existingNote = dateNotes.find(note => {
        const noteDate = new Date(note.date);
        return noteDate.getDate() === date.getDate() && 
               noteDate.getMonth() === date.getMonth() && 
               noteDate.getFullYear() === date.getFullYear();
      });
      
      if (existingNote) {
        // Edit catatan yang sudah ada
        document.getElementById('dateNoteTitle').value = existingNote.title;
        document.getElementById('dateNoteContentText').value = existingNote.content;
        document.getElementById('dateNoteColor').value = existingNote.color || '';
        document.getElementById('deleteDateNoteBtn').style.display = 'block';
      } else {
        // Catatan baru
        document.getElementById('dateNoteTitle').value = '';
        document.getElementById('dateNoteContentText').value = '';
        document.getElementById('dateNoteColor').value = '';
        document.getElementById('deleteDateNoteBtn').style.display = 'none';
      }
      
      document.getElementById('dateNoteModal').classList.add('show');
    }
    
    // Tutup modal catatan tanggal
    function closeDateNoteModal() {
      document.getElementById('dateNoteModal').classList.remove('show');
    }
    
    // Simpan catatan tanggal
    function saveDateNote() {
      const title = document.getElementById('dateNoteTitle').value.trim();
      const content = document.getElementById('dateNoteContentText').value.trim();
      const color = document.getElementById('dateNoteColor').value;
      
      if (!title || !content) {
        alert('Judul dan isi catatan harus diisi');
        return;
      }
      
      if (!selectedDate) {
        alert('Tanggal tidak valid');
        return;
      }
      
      // Format tanggal untuk penyimpanan
      const dateString = selectedDate.toISOString().split('T')[0];
      
      // Cek apakah sudah ada catatan untuk tanggal ini
      const existingNoteIndex = dateNotes.findIndex(note => note.date === dateString);
      
      if (existingNoteIndex !== -1) {
        // Update catatan yang sudah ada
        dateNotes[existingNoteIndex].title = title;
        dateNotes[existingNoteIndex].content = content;
        dateNotes[existingNoteIndex].color = color;
        dateNotes[existingNoteIndex].updatedAt = new Date().toISOString();
      } else {
        // Tambah catatan baru
        const newNote = {
          id: generateId(),
          date: dateString,
          title,
          content,
          color,
          createdAt: new Date().toISOString(),
          updatedAt: new Date().toISOString()
        };
        
        dateNotes.push(newNote);
      }
      
      saveData();
      renderCalendar();
      closeDateNoteModal();
      showToast('Catatan tanggal berhasil disimpan');
    }
    
    // Hapus catatan tanggal
    function deleteDateNote() {
      if (!selectedDate) return;
      
      const dateString = selectedDate.toISOString().split('T')[0];
      dateNotes = dateNotes.filter(note => note.date !== dateString);
      
      saveData();
      renderCalendar();
      closeDateNoteModal();
      showToast('Catatan tanggal berhasil dihapus');
    }
    
    // Timer functions
    function startTimer() {
      if (isTimerRunning) return;
      
      isTimerRunning = true;
      document.getElementById('startTimer').textContent = 'Lanjutkan';
      document.getElementById('pauseTimer').disabled = false;
      
      timerInterval = setInterval(() => {
        timerSeconds--;
        updateTimerDisplay();
        
        if (timerSeconds <= 0) {
          clearInterval(timerInterval);
          isTimerRunning = false;
          timerComplete();
        }
      }, 1000);
    }
    
    function pauseTimer() {
      if (!isTimerRunning) return;
      
      clearInterval(timerInterval);
      isTimerRunning = false;
      document.getElementById('startTimer').textContent = 'Lanjutkan';
    }
    
    function resetTimer() {
      clearInterval(timerInterval);
      isTimerRunning = false;
      
      if (timerMode === 'focus') {
        timerSeconds = FOCUS_TIME;
      } else if (timerMode === 'short') {
        timerSeconds = SHORT_BREAK_TIME;
      } else if (timerMode === 'long') {
        timerSeconds = LONG_BREAK_TIME;
      }
      
      updateTimerDisplay();
      document.getElementById('startTimer').textContent = 'Mulai';
      document.getElementById('pauseTimer').disabled = true;
      document.getElementById('timerProgress').style.width = '0%';
    }
    
    function switchTimerMode(mode) {
      // Update tombol mode
      document.querySelectorAll('.timer-mode-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
      
      // Set mode
      timerMode = mode;
      
      // Reset timer dengan durasi baru
      resetTimer();
    }
    
    function updateTimerDisplay() {
      const minutes = Math.floor(timerSeconds / 60);
      const seconds = timerSeconds % 60;
      document.getElementById('timerDisplay').textContent = 
        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      
      // Update progress bar
      let totalSeconds;
      if (timerMode === 'focus') {
        totalSeconds = FOCUS_TIME;
      } else if (timerMode === 'short') {
        totalSeconds = SHORT_BREAK_TIME;
      } else if (timerMode === 'long') {
        totalSeconds = LONG_BREAK_TIME;
      }
      
      const progress = ((totalSeconds - timerSeconds) / totalSeconds) * 100;
      document.getElementById('timerProgress').style.width = `${progress}%`;
    }
    
    function timerComplete() {
      // Tambah statistik
      if (timerMode === 'focus') {
        productivityData.todayPomodoros++;
        productivityData.weekPomodoros++;
        productivityData.totalPomodoros++;
        productivityData.focusTime += FOCUS_TIME / 60; // Konversi ke menit
        
        // Tambah ke history
        productivityData.pomodoroHistory.push({
          date: new Date().toISOString(),
          duration: FOCUS_TIME / 60
        });
        
        // Update UI
        updateProductivityStats();
        
        // Tampilkan notifikasi
        showToast('Sesi fokus selesai! Istirahat sejenak.', 5000);
        addNotification('Sesi Fokus Selesai', 'Sesi fokus Anda telah selesai. Istirahat sejenak untuk hasil terbaik.', 'info');
        
        // Otomatis switch ke break pendek
        switchTimerMode('short');
      } else {
        // Break selesai
        showToast('Istirahat selesai! Siap untuk fokus lagi.', 5000);
        
        // Otomatis switch ke fokus
        switchTimerMode('focus');
      }
      
      saveData();
    }
    
    // Simpan pengaturan timer
    function saveTimerSettings() {
      const focusDuration = parseInt(document.getElementById('focusDurationSetting').value);
      const shortBreakDuration = parseInt(document.getElementById('shortBreakDurationSetting').value);
      const longBreakDuration = parseInt(document.getElementById('longBreakDurationSetting').value);
      
      if (isNaN(focusDuration) || isNaN(shortBreakDuration) || isNaN(longBreakDuration) ||
          focusDuration < 1 || shortBreakDuration < 1 || longBreakDuration < 1) {
        alert('Durasi harus berupa angka positif');
        return;
      }
      
      // Update pengaturan
      appSettings.timerSettings.focusDuration = focusDuration;
      appSettings.timerSettings.shortBreakDuration = shortBreakDuration;
      appSettings.timerSettings.longBreakDuration = longBreakDuration;
      
      // Update konstanta timer
      FOCUS_TIME = focusDuration * 60;
      SHORT_BREAK_TIME = shortBreakDuration * 60;
      LONG_BREAK_TIME = longBreakDuration * 60;
      
      // Reset timer dengan pengaturan baru
      resetTimer();
      
      // Simpan pengaturan
      saveData();
      
      showToast('Pengaturan timer berhasil disimpan');
    }
    
    // Update statistik produktivitas
    function updateProductivityStats() {
      document.getElementById('todayPomodoros').textContent = productivityData.todayPomodoros;
      document.getElementById('weekPomodoros').textContent = productivityData.weekPomodoros;
      document.getElementById('totalPomodoros').textContent = productivityData.totalPomodoros;
      document.getElementById('focusTime').textContent = Math.round(productivityData.focusTime);
      
      // Update chart produktivitas
      updateProductivityChart();
    }
    
    // Update dashboard
    function updateDashboard() {
      // Hitung statistik
      const totalTasks = tasks.length;
      const completedTasks = tasks.filter(task => task.completed).length;
      const pendingTasks = totalTasks - completedTasks;
      
      // Update statistik cepat
      document.getElementById('dashboardTotalTasks').textContent = totalTasks;
      document.getElementById('dashboardCompleted').textContent = completedTasks;
      document.getElementById('dashboardFocusTime').textContent = Math.round(productivityData.focusTime);
      
      // Hitung produktivitas (persentase tugas selesai)
      const productivity = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
      document.getElementById('dashboardProductivity').textContent = `${productivity}%`;
      
      // Update tugas mendesak
      updateUrgentTasks();
      
      // Update pencapaian
      updateAchievements();
      
      // Update chart aktivitas
      updateDashboardActivityChart();
      
      // Simpan data dashboard
      dashboardData.totalTasks = totalTasks;
      dashboardData.completedTasks = completedTasks;
      dashboardData.focusTime = productivityData.focusTime;
      dashboardData.productivity = productivity;
      saveData();
    }
    
    // Update tugas mendesak
    function updateUrgentTasks() {
      const urgentTasksList = document.getElementById('urgentTasksList');
      
      const now = new Date();
      const leadDays = appSettings.notificationLeadDays;
      const leadTime = leadDays * 24 * 60 * 60 * 1000; // dalam milidetik
      
      // Tugas yang deadline dalam X hari dan belum selesai
      const dueSoonTasks = tasks.filter(task => {
        if (task.completed) return false;
        if (!task.deadline) return false;
        
        const deadline = new Date(task.deadline);
        const timeUntilDeadline = deadline - now;
        
        return timeUntilDeadline > 0 && timeUntilDeadline <= leadTime;
      });
      
      // Tugas yang terlambat dan belum selesai
      const overdueTasks = tasks.filter(task => {
        if (task.completed) return false;
        return isTaskOverdue(task);
      });
      
      // Gabungkan dan ambil maksimal 5 tugas
      const allUrgentTasks = [...overdueTasks, ...dueSoonTasks].slice(0, 5);
      
      if (allUrgentTasks.length === 0) {
        urgentTasksList.innerHTML = `
          <div class="empty-state">
            <p>Tidak ada tugas mendesak</p>
          </div>
        `;
        return;
      }
      
      urgentTasksList.innerHTML = '';
      allUrgentTasks.forEach(task => {
        const taskElement = document.createElement('div');
        taskElement.className = 'task-card';
        taskElement.style.marginBottom = '10px';
        taskElement.style.padding = '12px';
        
        // Tentukan kelas indikator prioritas
        let priorityIndicatorClass = '';
        if (task.priority === 'high') {
          priorityIndicatorClass = 'priority-high-indicator';
        } else if (task.priority === 'medium') {
          priorityIndicatorClass = 'priority-medium-indicator';
        } else {
          priorityIndicatorClass = 'priority-low-indicator';
        }
        
        taskElement.innerHTML = `
          <div class="task-title">
            <span class="priority-indicator ${priorityIndicatorClass}"></span>
            <span class="title-text">${escapeHtml(task.title)}</span>
          </div>
          <div class="task-detail">
            <span> ${formatDate(task.deadline)}</span>
            <span>${isTaskOverdue(task) ? ' Terlambat' : ' Deadline Mendekati'}</span>
          </div>
          <div class="task-actions">
            <button class="icon-btn" onclick="toggleTaskCompletion('${task.id}')" title="Tandai selesai"></button>
            <button class="icon-btn" onclick="editTask('${task.id}')" title="Edit tugas"></button>
          </div>
        `;
        
        urgentTasksList.appendChild(taskElement);
      });
    }
    
    // Update pencapaian
    function updateAchievements() {
      const achievementsList = document.getElementById('achievementsList');
      
      // Hitung pencapaian berdasarkan statistik
      const newAchievements = [];
      
      // Pencapaian berdasarkan jumlah tugas
      if (tasks.length >= 10) {
        newAchievements.push({
          id: 'task10',
          title: 'Pekerja Keras',
          description: 'Buat 10 tugas',
          icon: '',
          unlocked: true
        });
      }
      
      if (tasks.filter(t => t.completed).length >= 5) {
        newAchievements.push({
          id: 'complete5',
          title: 'Produktif',
          description: 'Selesaikan 5 tugas',
          icon: '',
          unlocked: true
        });
      }
      
      // Pencapaian berdasarkan fokus
      if (productivityData.totalPomodoros >= 5) {
        newAchievements.push({
          id: 'focus5',
          title: 'Fokus Tinggi',
          description: 'Selesaikan 5 sesi fokus',
          icon: '',
          unlocked: true
        });
      }
      
      if (productivityData.focusTime >= 60) {
        newAchievements.push({
          id: 'focus60',
          title: 'Ahli Fokus',
          description: 'Akumulasi 1 jam fokus',
          icon: '',
          unlocked: true
        });
      }
      
      // Pencapaian berdasarkan konsistensi
      const today = new Date();
      const lastWeek = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
      const recentTasks = tasks.filter(t => new Date(t.createdAt) >= lastWeek);
      
      if (recentTasks.length >= 7) {
        newAchievements.push({
          id: 'consistent7',
          title: 'Konsisten',
          description: 'Buat tugas selama 7 hari berturut-turut',
          icon: '',
          unlocked: true
        });
      }
      
      // Update daftar pencapaian
      achievements = newAchievements;
      
      if (achievements.length === 0) {
        achievementsList.innerHTML = `
          <div class="empty-state">
            <p>Belum ada pencapaian</p>
          </div>
        `;
        return;
      }
      
      achievementsList.innerHTML = '';
      achievements.forEach(achievement => {
        const achievementElement = document.createElement('div');
        achievementElement.className = 'task-card';
        achievementElement.style.marginBottom = '10px';
        achievementElement.style.padding = '12px';
        achievementElement.style.opacity = achievement.unlocked ? '1' : '0.5';
        
        achievementElement.innerHTML = `
          <div class="task-title">
            <span style="font-size: 24px;">${achievement.icon}</span>
            <span class="title-text">${achievement.title}</span>
          </div>
          <div class="task-detail">
            ${achievement.description}
          </div>
        `;
        
        achievementsList.appendChild(achievementElement);
      });
      
      saveData();
    }
    
    // Update statistik
    function updateStats() {
      const totalTasks = tasks.length;
      const completedTasks = tasks.filter(task => task.completed).length;
      const pendingTasks = totalTasks - completedTasks;
      const overdueTasks = tasks.filter(task => isTaskOverdue(task) && !task.completed).length;
      
      const today = new Date();
      const startOfToday = new Date(today.getFullYear(), today.getMonth(), today.getDate());
      const startOfWeek = new Date(today.getFullYear(), today.getMonth(), today.getDate() - today.getDay());
      
      const todayTasks = tasks.filter(task => {
        if (!task.deadline) return false;
        const taskDate = new Date(task.deadline);
        return taskDate >= startOfToday && taskDate < new Date(startOfToday.getTime() + 24 * 60 * 60 * 1000);
      }).length;
      
      const weekTasks = tasks.filter(task => {
        if (!task.deadline) return false;
        const taskDate = new Date(task.deadline);
        return taskDate >= startOfWeek && taskDate < new Date(startOfWeek.getTime() + 7 * 24 * 60 * 60 * 1000);
      }).length;
      
      // Update statistik di modal
      document.getElementById('totalTasks').textContent = totalTasks;
      document.getElementById('completedTasks').textContent = completedTasks;
      document.getElementById('pendingTasks').textContent = pendingTasks;
      document.getElementById('overdueTasks').textContent = overdueTasks;
      document.getElementById('todayTasks').textContent = todayTasks;
      document.getElementById('weekTasks').textContent = weekTasks;
      
      // Update chart
      updateTaskChart();
      updatePriorityChart();
    }
    
    // Update statistik di halaman beranda
    function updateHomeStats() {
      const totalTasks = tasks.length;
      const completedTasks = tasks.filter(task => task.completed).length;
      const pendingTasks = totalTasks - completedTasks;
      const overdueTasks = tasks.filter(task => isTaskOverdue(task) && !task.completed).length;
      
      document.getElementById('totalTasksHome').textContent = totalTasks;
      document.getElementById('completedTasksHome').textContent = completedTasks;
      document.getElementById('pendingTasksHome').textContent = pendingTasks;
      document.getElementById('overdueTasksHome').textContent = overdueTasks;
      
      // Update chart di beranda
      updateHomeTaskChart();
    }
    
    // Inisialisasi chart
    function initCharts() {
      // Chart untuk halaman beranda
      const homeTaskCtx = document.getElementById('homeTaskChart').getContext('2d');
      homeTaskChart = new Chart(homeTaskCtx, {
        type: 'doughnut',
        data: {
          labels: ['Selesai', 'Belum Selesai', 'Terlambat'],
          datasets: [{
            data: [0, 0, 0],
            backgroundColor: [
              'rgba(16, 185, 129, 0.8)',
              'rgba(59, 130, 246, 0.8)',
              'rgba(239, 68, 68, 0.8)'
            ],
            borderColor: [
              'rgba(16, 185, 129, 1)',
              'rgba(59, 130, 246, 1)',
              'rgba(239, 68, 68, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim(),
                font: {
                  size: 12
                }
              }
            },
            title: {
              display: true,
              text: 'Status Tugas',
              color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim(),
              font: {
                size: 14
              }
            }
          }
        }
      });
      
      // Chart untuk modal statistik
      const taskCtx = document.getElementById('taskChart').getContext('2d');
      taskChart = new Chart(taskCtx, {
        type: 'bar',
        data: {
          labels: ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'],
          datasets: [{
            label: 'Tugas Selesai',
            data: [0, 0, 0, 0, 0, 0, 0],
            backgroundColor: 'rgba(16, 185, 129, 0.8)',
            borderColor: 'rgba(16, 185, 129, 1)',
            borderWidth: 1
          }, {
            label: 'Tugas Baru',
            data: [0, 0, 0, 0, 0, 0, 0],
            backgroundColor: 'rgba(59, 130, 246, 0.8)',
            borderColor: 'rgba(59, 130, 246, 1)',
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim()
              },
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              }
            },
            x: {
              ticks: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim()
              },
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              }
            }
          },
          plugins: {
            legend: {
              labels: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim()
              }
            }
          }
        }
      });
      
      // Chart prioritas
      const priorityCtx = document.getElementById('priorityChart').getContext('2d');
      priorityChart = new Chart(priorityCtx, {
        type: 'pie',
        data: {
          labels: ['Tinggi', 'Sedang', 'Rendah'],
          datasets: [{
            data: [0, 0, 0],
            backgroundColor: [
              'rgba(239, 68, 68, 0.8)',
              'rgba(245, 158, 11, 0.8)',
              'rgba(16, 185, 129, 0.8)'
            ],
            borderColor: [
              'rgba(239, 68, 68, 1)',
              'rgba(245, 158, 11, 1)',
              'rgba(16, 185, 129, 1)'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
              labels: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim()
              }
            }
          }
        }
      });
      
      // Chart produktivitas
      const productivityCtx = document.getElementById('productivityChart').getContext('2d');
      productivityChart = new Chart(productivityCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'Sesi Fokus',
            data: [],
            backgroundColor: 'rgba(139, 92, 246, 0.2)',
            borderColor: 'rgba(139, 92, 246, 1)',
            borderWidth: 2,
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim()
              },
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              }
            },
            x: {
              ticks: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim()
              },
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              }
            }
          },
          plugins: {
            legend: {
              labels: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim()
              }
            }
          }
        }
      });
      
      // Chart aktivitas dashboard
      const dashboardActivityCtx = document.getElementById('dashboardActivityChart').getContext('2d');
      dashboardActivityChart = new Chart(dashboardActivityCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'Tugas Selesai',
            data: [],
            backgroundColor: 'rgba(16, 185, 129, 0.2)',
            borderColor: 'rgba(16, 185, 129, 1)',
            borderWidth: 2,
            tension: 0.3,
            fill: true
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim()
              },
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              }
            },
            x: {
              ticks: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim()
              },
              grid: {
                color: 'rgba(255, 255, 255, 0.1)'
              }
            }
          },
          plugins: {
            legend: {
              labels: {
                color: getComputedStyle(document.documentElement).getPropertyValue('--muted').trim()
              }
            }
          }
        }
      });
      
      // Update chart dengan data awal
      updateHomeTaskChart();
      updateTaskChart();
      updatePriorityChart();
      updateProductivityChart();
      updateDashboardActivityChart();
    }
    
    // Update chart tugas di beranda
    function updateHomeTaskChart() {
      if (!homeTaskChart) return;
      
      const completedTasks = tasks.filter(task => task.completed).length;
      const pendingTasks = tasks.filter(task => !task.completed && !isTaskOverdue(task)).length;
      const overdueTasks = tasks.filter(task => isTaskOverdue(task) && !task.completed).length;
      
      homeTaskChart.data.datasets[0].data = [completedTasks, pendingTasks, overdueTasks];
      homeTaskChart.update();
    }
    
    // Update chart tugas di modal statistik
    function updateTaskChart() {
      if (!taskChart) return;
      
      // Hitung tugas per hari dalam seminggu terakhir
      const today = new Date();
      const dayLabels = [];
      const completedData = [];
      const newData = [];
      
      for (let i = 6; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);
        
        const dayName = getDayName(date.getDay());
        dayLabels.push(dayName);
        
        // Hitung tugas yang diselesaikan pada hari ini
        const completedCount = tasks.filter(task => {
          if (!task.completed) return false;
          const completedDate = new Date(task.updatedAt);
          return completedDate.getDate() === date.getDate() &&
                 completedDate.getMonth() === date.getMonth() &&
                 completedDate.getFullYear() === date.getFullYear();
        }).length;
        
        // Hitung tugas yang dibuat pada hari ini
        const newCount = tasks.filter(task => {
          const createdDate = new Date(task.createdAt);
          return createdDate.getDate() === date.getDate() &&
                 createdDate.getMonth() === date.getMonth() &&
                 createdDate.getFullYear() === date.getFullYear();
        }).length;
        
        completedData.push(completedCount);
        newData.push(newCount);
      }
      
      taskChart.data.labels = dayLabels;
      taskChart.data.datasets[0].data = completedData;
      taskChart.data.datasets[1].data = newData;
      taskChart.update();
    }
    
    // Update chart prioritas
    function updatePriorityChart() {
      if (!priorityChart) return;
      
      const highPriority = tasks.filter(task => task.priority === 'high').length;
      const mediumPriority = tasks.filter(task => task.priority === 'medium').length;
      const lowPriority = tasks.filter(task => task.priority === 'low').length;
      
      priorityChart.data.datasets[0].data = [highPriority, mediumPriority, lowPriority];
      priorityChart.update();
    }
    
    // Update chart produktivitas
    function updateProductivityChart() {
      if (!productivityChart) return;
      
      // Hitung sesi fokus per hari dalam seminggu terakhir
      const today = new Date();
      const dayLabels = [];
      const focusData = [];
      
      for (let i = 6; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);
        
        const dayName = getDayName(date.getDay());
        dayLabels.push(dayName);
        
        // Hitung sesi fokus pada hari ini
        const focusCount = productivityData.pomodoroHistory.filter(session => {
          const sessionDate = new Date(session.date);
          return sessionDate.getDate() === date.getDate() &&
                 sessionDate.getMonth() === date.getMonth() &&
                 sessionDate.getFullYear() === date.getFullYear();
        }).length;
        
        focusData.push(focusCount);
      }
      
      productivityChart.data.labels = dayLabels;
      productivityChart.data.datasets[0].data = focusData;
      productivityChart.update();
    }
    
    // Update chart aktivitas dashboard
    function updateDashboardActivityChart() {
      if (!dashboardActivityChart) return;
      
      // Hitung tugas selesai per hari dalam seminggu terakhir
      const today = new Date();
      const dayLabels = [];
      const completedData = [];
      
      for (let i = 6; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);
        
        const dayName = getDayName(date.getDay());
        dayLabels.push(dayName);
        
        // Hitung tugas yang diselesaikan pada hari ini
        const completedCount = tasks.filter(task => {
          if (!task.completed) return false;
          const completedDate = new Date(task.updatedAt);
          return completedDate.getDate() === date.getDate() &&
                 completedDate.getMonth() === date.getMonth() &&
                 completedDate.getFullYear() === date.getFullYear();
        }).length;
        
        completedData.push(completedCount);
      }
      
      dashboardActivityChart.data.labels = dayLabels;
      dashboardActivityChart.data.datasets[0].data = completedData;
      dashboardActivityChart.update();
    }
    
    // Menu functions
    function openMenu() {
      document.getElementById('menuDrawer').classList.add('open');
    }
    
    function closeMenu() {
      document.getElementById('menuDrawer').classList.remove('open');
    }
    
    function handleMenuItemClick(action) {
      closeMenu();
      
      switch(action) {
        case 'portfolio':
          window.open('https://portofolio-rahmatsite.vercel.app', '_blank');
          break;
        case 'contact':
          openContactModal();
          break;
        case 'profile':
          openProfileModal();
          break;
        case 'settings':
          openSettingsModal();
          break;
        case 'tips':
          openTipsModal();
          break;
        case 'focus':
          switchTab('productivity');
          break;
        case 'backup':
          backupData();
          break;
        case 'export':
          exportData();
          break;
        case 'import':
          importData();
          break;
        case 'theme':
          openThemeModal();
          break;
        case 'about':
          openAboutModal();
          break;
        case 'reset':
          resetData();
          break;
      }
    }
    
    // Modal functions
    function openStatsModal() {
      updateStats();
      document.getElementById('statsModal').classList.add('show');
    }
    
    function closeStatsModal() {
      document.getElementById('statsModal').classList.remove('show');
    }
    
    function openThemeModal() {
      document.getElementById('themeModal').classList.add('show');
    }
    
    function closeThemeModal() {
      document.getElementById('themeModal').classList.remove('show');
    }
    
    // Fungsi ganti tema - DIPERBARUI
    function changeTheme(theme) {
      applyTheme(theme);
      closeThemeModal();
      showToast(`Tema ${theme} diaktifkan`);
    }
    
    function openProfileModal() {
      updateProfileUI();
      document.getElementById('profileModal').classList.add('show');
    }
    
    function closeProfileModal() {
      document.getElementById('profileModal').classList.remove('show');
    }
    
    function openEditProfileModal() {
      document.getElementById('editName').value = userProfile.name;
      document.getElementById('editTitle').value = userProfile.title;
      document.getElementById('editBio').value = userProfile.bio;
      document.getElementById('editProfileModal').classList.add('show');
    }
    
    function closeEditProfileModal() {
      document.getElementById('editProfileModal').classList.remove('show');
    }
    
    function openAvatarModal() {
      document.getElementById('avatarPreview').src = userProfile.avatar || '';
      document.getElementById('avatarModal').classList.add('show');
    }
    
    function closeAvatarModal() {
      document.getElementById('avatarModal').classList.remove('show');
    }
    
    function confirmDeleteProfile() {
      document.getElementById('deleteModal').classList.add('show');
    }
    
    function closeDeleteModal() {
      document.getElementById('deleteModal').classList.remove('show');
    }
    
    function openSettingsModal() {
      updateSettingsUI();
      document.getElementById('settingsModal').classList.add('show');
    }
    
    function closeSettingsModal() {
      document.getElementById('settingsModal').classList.remove('show');
    }
    
    function openTipsModal() {
      document.getElementById('tipsModal').classList.add('show');
    }
    
    function closeTipsModal() {
      document.getElementById('tipsModal').classList.remove('show');
    }
    
    function openAboutModal() {
      document.getElementById('aboutModal').classList.add('show');
    }
    
    function closeAboutModal() {
      document.getElementById('aboutModal').classList.remove('show');
    }
    
    function openNotificationsModal() {
      updateNotificationsUI();
      document.getElementById('notificationsModal').classList.add('show');
    }
    
    function closeNotificationsModal() {
      document.getElementById('notificationsModal').classList.remove('show');
    }
    
    function openContactModal() {
      document.getElementById('contactModal').classList.add('show');
    }
    
    function closeContactModal() {
      document.getElementById('contactModal').classList.remove('show');
    }
    
    // Handle contact item click
    function handleContactClick(type) {
      let url = '';
      switch(type) {
        case 'email':
          url = 'mailto:rohmatulloh.3609@gmail.com';
          break;
        case 'whatsapp':
          url = 'https://wa.me/6285931109567';
          break;
        case 'telegram':
          url = 'https://t.me/+ZgzJjLBWb7QzNjNl';
          break;
        case 'instagram':
          url = 'https://www.instagram.com/rahmt_nhw?igsh=MWQwcnB3bTA2ZnVidg==';
          break;
        case 'github':
          url = 'https://github.com/username';
          break;
      }
      if (url) {
        window.open(url, '_blank');
      }
    }
    
    // Profile functions
    function updateProfileUI() {
      document.getElementById('profileName').textContent = userProfile.name;
      document.getElementById('profileDesc').textContent = userProfile.title;
      
      document.getElementById('profileDisplayName').textContent = userProfile.name;
      document.getElementById('profileDisplayTitle').textContent = userProfile.title;
      document.getElementById('profileDisplayBio').textContent = userProfile.bio;
      
      // Update avatar di modal profil
      const profileAvatarImg = document.getElementById('profileAvatarImg');
      if (userProfile.avatarType === 'emoji') {
        profileAvatarImg.style.display = 'none';
      } else if (userProfile.avatarType === 'image' && userProfile.avatar) {
        profileAvatarImg.src = userProfile.avatar;
        profileAvatarImg.style.display = 'block';
      } else {
        profileAvatarImg.style.display = 'none';
      }
      
      // Update avatar di menu
      const menuAvatar = document.getElementById('profileAvatar');
      if (userProfile.avatarType === 'emoji') {
        menuAvatar.textContent = userProfile.avatarEmoji;
        menuAvatar.innerHTML = ''; // Clear any existing image
      } else if (userProfile.avatarType === 'image' && userProfile.avatar) {
        menuAvatar.innerHTML = `<img src="${userProfile.avatar}" alt="Avatar" style="width:100%; height:100%; border-radius:50%; object-fit:cover;">`;
      } else {
        menuAvatar.textContent = '';
        menuAvatar.innerHTML = ''; // Clear any existing image
      }
      
      // Update statistik profil
      const completedTasks = tasks.filter(task => task.completed).length;
      const totalTasks = tasks.length;
      const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
      
      document.getElementById('statTasksCompleted').textContent = completedTasks;
      document.getElementById('statActiveProjects').textContent = tasks.filter(task => !task.completed).length;
      document.getElementById('statCompletionRate').textContent = `${completionRate}%`;
    }
    
    function saveEditProfile() {
      const name = document.getElementById('editName').value.trim();
      const title = document.getElementById('editTitle').value.trim();
      const bio = document.getElementById('editBio').value.trim();
      
      if (!name) {
        alert('Nama harus diisi');
        return;
      }
      
      userProfile.name = name;
      userProfile.title = title;
      userProfile.bio = bio;
      
      saveData();
      updateProfileUI();
      closeEditProfileModal();
      
      showToast('Profil berhasil diperbarui');
    }
    
    function triggerAvatarUpload() {
      document.getElementById('avatarInput').click();
    }
    
    // Fungsi untuk memproses gambar menjadi 1:1 tanpa crop
    function processImageForAvatar(image, callback) {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      
      // Ukuran avatar (120x120)
      const size = 120;
      canvas.width = size;
      canvas.height = size;
      
      // Hitung rasio gambar asli
      const ratio = image.width / image.height;
      
      // Tentukan dimensi untuk menggambar gambar asli di canvas
      let drawWidth, drawHeight, x, y;
      
      if (ratio > 1) {
        // Gambar landscape -> kita set width 120, height disesuaikan
        drawWidth = size;
        drawHeight = size / ratio;
        x = 0;
        y = (size - drawHeight) / 2;
      } else {
        // Gambar portrait -> kita set height 120, width disesuaikan
        drawHeight = size;
        drawWidth = size * ratio;
        x = (size - drawWidth) / 2;
        y = 0;
      }
      
      // Isi background transparan
      ctx.clearRect(0, 0, size, size);
      
      // Gambar gambar ke canvas
      ctx.drawImage(image, x, y, drawWidth, drawHeight);
      
      // Konversi ke data URL
      const dataUrl = canvas.toDataURL('image/png');
      callback(dataUrl);
    }
    
    function handleAvatarUpload(e) {
      const file = e.target.files[0];
      if (!file) return;

      if (!file.type.startsWith('image/')) {
        alert('Harap pilih file gambar');
        return;
      }

      const reader = new FileReader();
      reader.onload = function(event) {
        const img = new Image();
        img.onload = function() {
          processImageForAvatar(img, function(dataUrl) {
            // Simpan sebagai avatar
            userProfile.avatar = dataUrl;
            userProfile.avatarType = 'image';
            
            // Update preview
            document.getElementById('avatarPreview').src = dataUrl;
            
            showToast('Foto profil berhasil diunggah');
          });
        };
        img.src = event.target.result;
      };
      reader.readAsDataURL(file);
    }
    
    function saveAvatar() {
      // Jika ada gambar yang sudah dipilih, langsung simpan
      if (userProfile.avatar) {
        userProfile.avatarType = 'image';
        saveData();
        updateProfileUI();
        closeAvatarModal();
        showToast('Avatar berhasil disimpan');
      } else {
        showToast('Pilih foto terlebih dahulu', 'error');
      }
    }
    
    function deleteAvatar() {
      userProfile.avatar = null;
      userProfile.avatarType = 'emoji';
      userProfile.avatarEmoji = '';
      
      saveData();
      updateProfileUI();
      closeDeleteModal();
      
      showToast('Foto profil berhasil dihapus');
    }
    
    // Settings functions
    function updateSettingsUI() {
      document.getElementById('notificationsEnabled').checked = appSettings.notificationsEnabled;
      document.getElementById('notificationLeadDays').value = appSettings.notificationLeadDays;
      document.getElementById('useBrowserNotification').checked = appSettings.useBrowserNotification;
      document.getElementById('autoSaveEnabled').checked = appSettings.autoSaveEnabled;
      document.getElementById('quickActionsEnabled').checked = appSettings.quickActionsEnabled;
      document.getElementById('darkReaderEnabled').checked = appSettings.darkReaderEnabled;
      document.getElementById('liteMode').checked = appSettings.liteMode;
      
      // Timer settings
      document.getElementById('focusDurationSetting').value = appSettings.timerSettings.focusDuration;
      document.getElementById('shortBreakDurationSetting').value = appSettings.timerSettings.shortBreakDuration;
      document.getElementById('longBreakDurationSetting').value = appSettings.timerSettings.longBreakDuration;
    }
    
    function saveSettings() {
      appSettings.notificationsEnabled = document.getElementById('notificationsEnabled').checked;
      appSettings.notificationLeadDays = parseInt(document.getElementById('notificationLeadDays').value);
      appSettings.useBrowserNotification = document.getElementById('useBrowserNotification').checked;
      appSettings.autoSaveEnabled = document.getElementById('autoSaveEnabled').checked;
      appSettings.quickActionsEnabled = document.getElementById('quickActionsEnabled').checked;
      appSettings.darkReaderEnabled = document.getElementById('darkReaderEnabled').checked;
      appSettings.liteMode = document.getElementById('liteMode').checked;
      
      saveData();
      updateLiteMode();
      closeSettingsModal();
      
      showToast('Pengaturan berhasil disimpan');
    }
    
    // Update mode ringan
    function updateLiteMode() {
      if (appSettings.liteMode) {
        document.body.classList.add('lite-mode');
      } else {
        document.body.classList.remove('lite-mode');
      }
    }
    
    // Notifications functions - DIPERBARUI
    function updateNotifications() {
      // Hitung notifikasi yang belum dibaca
      const unreadCount = notifications.filter(notif => !notif.read).length;
      const notifBadge = document.getElementById('notifBadge');
      
      if (unreadCount > 0) {
        notifBadge.textContent = unreadCount > 9 ? '9+' : unreadCount;
        notifBadge.style.display = 'flex';
      } else {
        notifBadge.style.display = 'none';
      }
    }
    
    function updateNotificationsUI() {
      const notificationsList = document.getElementById('notificationsList');
      
      if (notifications.length === 0) {
        notificationsList.innerHTML = `
          <div class="empty-state">
            <h3>Tidak ada notifikasi</h3>
            <p>Notifikasi akan muncul di sini</p>
          </div>
        `;
        return;
      }
      
      // Urutkan notifikasi: yang belum dibaca di atas, lalu berdasarkan tanggal terbaru
      const sortedNotifications = [...notifications].sort((a, b) => {
        if (!a.read && b.read) return -1;
        if (a.read && !b.read) return 1;
        return new Date(b.date) - new Date(a.date);
      });
      
      notificationsList.innerHTML = '';
      
      sortedNotifications.forEach(notif => {
        const notificationContainer = document.createElement('div');
        notificationContainer.className = `notification-container ${notif.read ? '' : 'unread'} swipeable-item`;
        notificationContainer.setAttribute('data-id', notif.id);
        
        const notifElement = document.createElement('div');
        notifElement.className = 'notification-item';
        
        // Tentukan ikon berdasarkan tipe
        let icon = '';
        let iconColor = 'var(--primary)';
        if (notif.type === 'success') {
          icon = '';
          iconColor = 'var(--success)';
        } else if (notif.type === 'warning') {
          icon = '';
          iconColor = 'var(--warning)';
        } else if (notif.type === 'error') {
          icon = '';
          iconColor = 'var(--danger)';
        }
        
        notifElement.innerHTML = `
          <div class="notification-icon" style="background: ${iconColor}20; color: ${iconColor}">${icon}</div>
          <div class="notification-content">
            <div class="notification-title">${escapeHtml(notif.title)}</div>
            <div class="notification-message">${escapeHtml(notif.message)}</div>
            <div class="notification-time">${formatDateTime(notif.date)}</div>
          </div>
        `;
        
        notificationContainer.appendChild(notifElement);
        
        // Setup swipe untuk notifikasi (hanya swipe tanpa tombol hapus)
        setupSwipeGesture(notificationContainer, notif.id, 'notification');
        
        // Tandai sebagai sudah dibaca saat diklik
        notifElement.addEventListener('click', function(e) {
          if (!notif.read) {
            notif.read = true;
            saveData();
            updateNotifications();
            notificationContainer.classList.remove('unread');
            showToast('Notifikasi ditandai sudah dibaca');
          }
        });
        
        notificationsList.appendChild(notificationContainer);
      });
    }
    
    // Setup swipe gesture untuk item
    function setupSwipeGesture(element, itemId, itemType) {
      let startX = 0;
      let currentX = 0;
      let isSwiping = true;
      
      element.addEventListener('touchstart', function(e) {
        startX = e.touches[0].clientX;
        isSwiping = true;
        element.classList.add('swiping');
      });
      
      element.addEventListener('touchmove', function(e) {
        if (!isSwiping) return;
        
        currentX = e.touches[0].clientX;
        const diff = startX - currentX;
        
        // Hanya izinkan swipe ke kiri (untuk hapus)
        if (diff > 0) {
          const translateX = Math.min(diff, 100); // Maksimal geser 100px
          element.style.transform = `translateX(-${translateX}px)`;
        }
      });
      
      element.addEventListener('touchend', function() {
        if (!isSwiping) return;
        
        isSwiping = false;
        element.classList.remove('swiping');
        const diff = startX - currentX;
        
        // Jika geser cukup jauh (lebih dari 60px), hapus item
        if (diff > 60) {
          element.classList.add('swipe-out');
          setTimeout(() => {
            if (itemType === 'notification') {
              deleteNotification(itemId);
            }
          }, 300);
        } else {
          // Kembalikan ke posisi semula
          element.style.transform = 'translateX(0)';
        }
      });
      
      // Juga support untuk mouse events (untuk desktop)
      element.addEventListener('mousedown', function(e) {
        startX = e.clientX;
        isSwiping = true;
        element.classList.add('swiping');
      });
      
      element.addEventListener('mousemove', function(e) {
        if (!isSwiping) return;
        
        currentX = e.clientX;
        const diff = startX - currentX;
        
        if (diff > 0) {
          const translateX = Math.min(diff, 100);
          element.style.transform = `translateX(-${translateX}px)`;
        }
      });
      
      element.addEventListener('mouseup', function() {
        if (!isSwiping) return;
        
        isSwiping = false;
        element.classList.remove('swiping');
        const diff = startX - currentX;
        
        if (diff > 60) {
          element.classList.add('swipe-out');
          setTimeout(() => {
            if (itemType === 'notification') {
              deleteNotification(itemId);
            }
          }, 300);
        } else {
          element.style.transform = 'translateX(0)';
        }
      });
      
      element.addEventListener('mouseleave', function() {
        if (isSwiping) {
          isSwiping = false;
          element.classList.remove('swiping');
          element.style.transform = 'translateX(0)';
        }
      });
    }
    
    function deleteNotification(notificationId) {
      notifications = notifications.filter(n => n.id !== notificationId);
      saveData();
      updateNotifications();
      updateNotificationsUI();
      showToast('Notifikasi dihapus');
    }
    
    function addNotification(title, message, type = 'info', id = null) {
      const newNotification = {
        id: id || generateId(),
        title,
        message,
        type,
        read: false,
        date: new Date().toISOString()
      };
      
      notifications.unshift(newNotification);
      
      // Batasi jumlah notifikasi
      if (notifications.length > 50) {
        notifications = notifications.slice(0, 50);
      }
      
      saveData();
      updateNotifications();
      
      // Tampilkan notifikasi browser jika diizinkan
      if (appSettings.useBrowserNotification && 'Notification' in window && Notification.permission === 'granted') {
        new Notification(title, {
          body: message,
          icon: 'icon-192.png'
        });
      }
    }
    
    // Backup dan restore functions
    function backupData() {
      const backupData = {
        tasks,
        schedules,
        notes,
        dateNotes,
        userProfile,
        productivityData,
        achievements,
        appSettings,
        backupDate: new Date().toISOString()
      };
      
      const dataStr = JSON.stringify(backupData, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      
      const url = URL.createObjectURL(dataBlob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `tugasku-backup-${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showToast('Backup data berhasil dibuat');
    }
    
    function exportData() {
      backupData(); // Sama dengan backup
    }
    
    function importData() {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = '.json';
      
      input.onchange = function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(event) {
          try {
            const importedData = JSON.parse(event.target.result);
            
            // Validasi data
            if (!importedData.tasks || !importedData.schedules || !importedData.notes) {
              throw new Error('Format file tidak valid');
            }
            
            // Konfirmasi import
            if (confirm('Import data akan menggantikan semua data saat ini. Lanjutkan?')) {
              tasks = importedData.tasks || [];
              schedules = importedData.schedules || [];
              notes = importedData.notes || [];
              dateNotes = importedData.dateNotes || [];
              userProfile = importedData.userProfile || userProfile;
              productivityData = importedData.productivityData || productivityData;
              achievements = importedData.achievements || [];
              appSettings = importedData.appSettings || appSettings;
              
              saveData();
              
              // Render ulang semua data
              renderTasks();
              renderSchedules();
              renderNotes();
              renderCalendar();
              updateDashboard();
              updateStats();
              updateProductivityStats();
              updateProfileUI();
              updateSettingsUI();
              updateAchievements();
              updateNotifications();
              
              showToast('Data berhasil diimport');
            }
          } catch (error) {
            alert('Error mengimport data: ' + error.message);
          }
        };
        reader.readAsText(file);
      };
      
      input.click();
    }
    
    function resetData() {
      if (confirm('Apakah Anda yakin ingin mereset semua data? Tindakan ini tidak dapat dibatalkan.')) {
        tasks = [];
        schedules = [];
        notes = [];
        dateNotes = [];
        productivityData = {
          todayPomodoros: 0,
          weekPomodoros: 0,
          totalPomodoros: 0,
          focusTime: 0,
          pomodoroHistory: []
        };
        achievements = [];
        notifications = [];
        
        saveData();
        
        // Render ulang semua data
        renderTasks();
        renderSchedules();
        renderNotes();
        renderCalendar();
        updateDashboard();
        updateStats();
        updateProductivityStats();
        updateAchievements();
        updateNotifications();
        
        showToast('Semua data berhasil direset');
      }
    }
    
    // Utility functions
    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }
    
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }
    
    function formatDate(dateString) {
      if (!dateString) return '-';
      
      const date = new Date(dateString);
      const options = { day: 'numeric', month: 'short', year: 'numeric' };
      return date.toLocaleDateString('id-ID', options);
    }
    
    function formatDateTime(dateString) {
      if (!dateString) return '-';
      
      const date = new Date(dateString);
      const options = { 
        day: 'numeric', 
        month: 'short', 
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      };
      return date.toLocaleDateString('id-ID', options);
    }
    
    function getDayName(dayIndex) {
      const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
      return days[dayIndex];
    }
    
    function getDayName(dayString) {
      const days = {
        'senin': 'Senin',
        'selasa': 'Selasa',
        'rabu': 'Rabu',
        'kamis': 'Kamis',
        'jumat': 'Jumat',
        'sabtu': 'Sabtu',
        'minggu': 'Minggu'
      };
      return days[dayString] || dayString;
    }
    
    function isTaskOverdue(task) {
      if (!task.deadline || task.completed) return false;
      
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      const deadline = new Date(task.deadline);
      deadline.setHours(0, 0, 0, 0);
      
      return deadline < today;
    }
    
    function isTaskDueToday(task) {
      if (!task.deadline || task.completed) return false;
      
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      const deadline = new Date(task.deadline);
      deadline.setHours(0, 0, 0, 0);
      
      return deadline.getTime() === today.getTime();
    }
    
    function isTaskDueSoon(task) {
      if (!task.deadline || task.completed) return false;
      
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      const deadline = new Date(task.deadline);
      deadline.setHours(0, 0, 0, 0);
      
      const diffTime = deadline.getTime() - today.getTime();
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      
      return diffDays >= 1 && diffDays <= 3;
    }
    
    function showToast(message, duration = 3000) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, duration);
    }
    
    // Ekspor fungsi ke global scope untuk akses dari HTML
    window.toggleTaskCompletion = toggleTaskCompletion;
    window.editTask = editTask;
    window.deleteTask = deleteTask;
    window.editSchedule = editSchedule;
    window.deleteSchedule = deleteSchedule;
    window.editNote = editNote;
    window.deleteNote = deleteNote;
    window.toggleNotePin = toggleNotePin;
    window.deleteNotification = deleteNotification;
  });
</script>
</body>
</html>